<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="description" content="Francis Tao-Jinjin Next.js GitHub Pages"/><meta property="og:image" content="https://og-image.now.sh/Francis%20Tao-Jinjin%20Next.js%20GitHub%20Pages.png?theme=light&amp;md=0&amp;fontSize=75px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><meta name="og:title" content="Francis Tao-Jinjin Next.js GitHub Pages"/><meta name="teitter:card" content="summary_large_image"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/default.min.css"/><title>Audio Adjustment Tool</title><meta name="next-head-count" content="9"/><link rel="preload" href="/_next/static/css/525ade0da8ac601406c9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/525ade0da8ac601406c9.css" data-n-g=""/><link rel="preload" href="/_next/static/css/7c37ee6f4b99f4530db0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7c37ee6f4b99f4530db0.css" data-n-g=""/><link rel="preload" href="/_next/static/css/ca491a2f2dad37bc344d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ca491a2f2dad37bc344d.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-fcbdb94e906b93a1f560.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.9d524150d48315f49e80.js" as="script"/><link rel="preload" href="/_next/static/chunks/7a55d4b5.210d3c80a2b0e2401248.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.ff0a5790a80e83d7223b.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-5d53db12a2c7a352dba7.js" as="script"/><link rel="preload" href="/_next/static/chunks/df27990eef8845831ef4a3353c0adb327953b68f.b37cb412c978ebbef724.js" as="script"/><link rel="preload" href="/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.a80097bea88316e5b19e.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bid%5D-dd642f1262e5265a6db6.js" as="script"/></head><body><div id="__next"><div class="layout_container__2t4v2"><header class="layout_header__2rhWq"><a href="/"><img src="/images/profile.png" class="layout_headerImage__2h5On utils_borderCircle__13qdJ" alt="Francis Tao"/></a><h2 class="utils_headingLg__de7p0"><a class="utils_colorInherit__3Gudf" href="/">Francis Tao</a></h2></header><article><h1 class="utils_headingXl__1XecN">Audio Adjustment Tool</h1><div class="utils_lightText__12Ckm"><time dateTime="2020-08-10">August 10, 2020</time></div><div><div class='markdown'></div>
<h1 class="text-3xl font-medium mb-2 mt-3">Audio Adjustment Tool Of Box3 Game Editor</h1>
<div class='m-5'></div>
<img src="/images/audio-adjust/audio-upload.gif" alt="audio upload" style="width:400px; margin:auto"/>
<div class='m-5'></div>
<p>This is a tool for uploading and simply processing audio in the box3 game editor. I have written a component specifically for this functionality, which in addition to React, will also involve the WebAudio API and canvas 2d.</p>
<div class='m-5'></div>
<p>The main functions of this component include: playing and pausing audio, cropping audio, and providing convenient UI controls and visual feedback for these functions.</p>
<div class='m-5'></div>
<p>For those who are not familiar with WebAudio API. All you need to know is the ‘Audio’ we talk about is actually a kind of data buffer that we call <code class='il'>AudioBuffer</code>. Whether it’s playing or cropping or even adding sound effects, it’s all about the buffer in the end.</p>
<div class='m-5'></div>
<p>To play an audioBuffer, we need to create an <code class='il'>AudioBufferSourceNode</code>, be noticed, an AudioBufferSourceNode can only be started and stop once. Otherwise, your javascript engine gonna throw an error.</p>
<div class='m-5'></div>
<p>Now we clear that we need to implement a class to handle all the operations to the audioBuffer and a React component to handle UI interaction.</p>
<div class='m-5'></div>
<p>We can call that  class ‘AudioPlayer’, it needs to support basic <code class='il'>play</code> and <code class='il'>stop</code>, besides, the user may want to start playback from any position of the audio, and the selected interval should support loop playback.</p>
<div class='preCodeBlock'></div>
<pre><code class="language-TypeScript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AudioPlayer</span> </span>{
    <span class="hljs-keyword">private</span> _state = <span class="hljs-string">&#x27;stopped&#x27;</span>;
    <span class="hljs-keyword">private</span> _offset = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> _startTime = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> _finished = <span class="hljs-literal">false</span>;
    <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params">
        <span class="hljs-keyword">private</span> audioBuffer:AudioBuffer,
        <span class="hljs-keyword">private</span> audioContext:AudioContext</span>)</span> {
    }

    <span class="hljs-keyword">private</span> _loopStart = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">set</span> <span class="hljs-title">loopStart</span>(<span class="hljs-params">value:<span class="hljs-built_in">number</span></span>) {
        ...
    }

    <span class="hljs-keyword">private</span> _loopEnd = <span class="hljs-literal">Infinity</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">set</span> <span class="hljs-title">loopEnd</span>(<span class="hljs-params">value:<span class="hljs-built_in">number</span></span>) {
        ...
    }

    <span class="hljs-keyword">private</span> _loop = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">set</span> <span class="hljs-title">loop</span>(<span class="hljs-params">flag:<span class="hljs-built_in">boolean</span></span>) {
        <span class="hljs-built_in">this</span>._loop = flag;
    }

    <span class="hljs-keyword">private</span> _source:AudioBufferSourceNode|<span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-title">now</span>(<span class="hljs-params"></span>)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.audioContext.currentTime;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-title">start</span>(<span class="hljs-params">startTime?:<span class="hljs-built_in">number</span>, offset?:<span class="hljs-built_in">number</span></span>)</span> {
        ...
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">get</span> <span class="hljs-title">state</span>() {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>._state;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">get</span> <span class="hljs-title">finished</span>() {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>._finished;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-title">stop</span>(<span class="hljs-params">time?:<span class="hljs-built_in">number</span></span>)</span> {
        ...
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-title">seek</span>(<span class="hljs-params">offset:<span class="hljs-built_in">number</span>, time:<span class="hljs-built_in">number</span></span>)</span> {
        ...
    }
}
</code></pre>
<p>The start method receives two optional params, <code class='il'>startTime</code> refer to the global time of ‘AudioContex’, if you want to start at the time you call the method, just pass  <code class='il'>audioContext.currentTime</code> to it. <code class='il'>offset</code> refers to the duration of the audio. If an audio is 1.5s long and you want to start playback from the 0.5s, then the <code class='il'>offset</code> is 0.5 .</p>
<p>Here is how I implement the <code class='il'>start</code> and <code class='il'>stop</code>method:</p>
<div class='preCodeBlock'></div>
<pre><code class="language-TypeScript"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-title">start</span>(<span class="hljs-params">startTime?:<span class="hljs-built_in">number</span>, offset?:<span class="hljs-built_in">number</span></span>)</span> {
    <span class="hljs-keyword">if</span> (startTime === <span class="hljs-literal">undefined</span>) {
        startTime = <span class="hljs-built_in">this</span>.now();
    }
    <span class="hljs-keyword">if</span> (offset === <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._loop) {
            offset = <span class="hljs-built_in">this</span>._loopStart;
        } <span class="hljs-keyword">else</span> {
            offset = <span class="hljs-number">0</span>;
        }
    }
    <span class="hljs-built_in">this</span>._source = <span class="hljs-built_in">this</span>.audioContext.createBufferSource();
    <span class="hljs-built_in">this</span>._source.connect(<span class="hljs-built_in">this</span>.audioContext.destination);
    <span class="hljs-built_in">this</span>._source.buffer = <span class="hljs-built_in">this</span>.audioBuffer;
    <span class="hljs-built_in">this</span>._source.onended = <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> now = <span class="hljs-built_in">this</span>.now();
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>._loop) {
            <span class="hljs-keyword">const</span> passTime = (now - <span class="hljs-built_in">this</span>._startTime + <span class="hljs-built_in">this</span>._offset);
            <span class="hljs-keyword">if</span> (passTime &gt;= <span class="hljs-built_in">this</span>.audioBuffer.duration) {
                <span class="hljs-built_in">this</span>._finished = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.audioBuffer.duration - passTime &gt;= <span class="hljs-number">0</span> &amp;&amp;
                        <span class="hljs-built_in">this</span>.audioBuffer.duration - passTime &lt;= <span class="hljs-number">1e-4</span>) {
                <span class="hljs-built_in">this</span>._finished = <span class="hljs-literal">true</span>;
            }
        }
    };
    <span class="hljs-built_in">this</span>._source.loop = <span class="hljs-built_in">this</span>._loop;
    <span class="hljs-built_in">this</span>._source.loopStart = <span class="hljs-built_in">this</span>._loopStart;
    <span class="hljs-built_in">this</span>._source.loopEnd = <span class="hljs-built_in">Math</span>.min(<span class="hljs-built_in">this</span>._loopEnd, <span class="hljs-built_in">this</span>.audioBuffer.duration);
    <span class="hljs-built_in">this</span>._state = <span class="hljs-string">&#x27;started&#x27;</span>;
    <span class="hljs-built_in">this</span>._source.start(startTime, offset);
    <span class="hljs-built_in">this</span>._offset = offset;
    <span class="hljs-built_in">this</span>._startTime = startTime;
}

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-title">stop</span>(<span class="hljs-params">time?:<span class="hljs-built_in">number</span></span>)</span> {
    <span class="hljs-keyword">if</span> (time === <span class="hljs-literal">undefined</span>) {
        time = <span class="hljs-built_in">this</span>.now();
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._source) {
        <span class="hljs-built_in">this</span>._source.stop(time);
        <span class="hljs-built_in">this</span>._source.disconnect();
        <span class="hljs-built_in">this</span>._state = <span class="hljs-string">&#x27;stopped&#x27;</span>;
    }
}
</code></pre>
<p>As for the <code class='il'>seek</code>, you can simply call <code class='il'>stop</code> then call <code class='il'>start</code> in it.</p>
<h2 class="text-xl font-medium mb-2 mt-3">Drawing the Waveform</h2>
<p>Drawing the waveform of audiobuffer is fairly easy. You don’t need to install another package to do it, all you need to do is some simple calculation. Many people like to install a bunch of extra modules to solve a small problem, but I prefer not to install them if I don’t need to. This allows you to keep your code light weight, and you can learn a lot of new things in the process.</p>
<div class='preCodeBlock'></div>
<pre><code class="language-TypeScript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">computeWaveForm</span>(<span class="hljs-params">container:HTMLDivElement, buffer:AudioBuffer</span>) </span>{
    <span class="hljs-keyword">const</span> peaks:<span class="hljs-built_in">number</span>[] = [];
    <span class="hljs-keyword">const</span> chann0 = (buffer.getChannelData(<span class="hljs-number">0</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">ArrayBuffer</span>);
    <span class="hljs-comment">// const sampleSize = props.buffer.length / props.waveformWidth;</span>
    <span class="hljs-keyword">const</span> sampleSize = buffer.length / container.clientWidth;
    <span class="hljs-keyword">const</span> sampleStep = ~~(sampleSize / <span class="hljs-number">10</span>) || <span class="hljs-number">1</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; container.clientWidth; i++) {
    <span class="hljs-comment">// for (let i = 0; i &lt; props.waveformWidth; i++) {</span>
        <span class="hljs-keyword">const</span> start = ~~(i * sampleSize);
        <span class="hljs-keyword">const</span> end = ~~(start + sampleSize);
        <span class="hljs-keyword">let</span> topCount = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">let</span> bottomCount = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">let</span> bottom = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">let</span> top = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = start; j &lt; end; j += sampleStep) {
            <span class="hljs-keyword">const</span> value = chann0[j];
            <span class="hljs-keyword">if</span> (value &gt; <span class="hljs-number">0</span>) {
                bottom += value * value;
                bottomCount++;
            }
            <span class="hljs-keyword">if</span> (value &lt; <span class="hljs-number">0</span>) {
                top += value * value;
                topCount++;
            }
        }
        peaks[<span class="hljs-number">2</span> * i] = <span class="hljs-built_in">Math</span>.sqrt(bottom / bottomCount) * <span class="hljs-number">256</span>;
        peaks[<span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>] = -<span class="hljs-built_in">Math</span>.sqrt(top / topCount) * <span class="hljs-number">256</span>;
    }
    <span class="hljs-keyword">return</span> peaks;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">drawWaveForm</span>(<span class="hljs-params">canvasEle:HTMLCanvasElement, container:HTMLDivElement, peaks:<span class="hljs-built_in">number</span>[], waveformHeight:<span class="hljs-built_in">number</span></span>) </span>{
    <span class="hljs-keyword">if</span> (canvasEle &amp;&amp; container) {
        <span class="hljs-keyword">const</span> cvsCtx = canvasEle.getContext(<span class="hljs-string">&#x27;2d&#x27;</span>);
        <span class="hljs-keyword">if</span> (cvsCtx) {
            <span class="hljs-keyword">let</span> dirty = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> (canvasEle.height !== waveformHeight) {
                dirty = <span class="hljs-literal">true</span>;
                canvasEle.style.height = waveformHeight + <span class="hljs-string">&#x27;px&#x27;</span>;
                canvasEle.height = waveformHeight;
            }
            <span class="hljs-keyword">if</span> (canvasEle.width !== container.clientWidth) {
                dirty = <span class="hljs-literal">true</span>;
                canvasEle.style.width = container.clientWidth + <span class="hljs-string">&#x27;px&#x27;</span>;
                canvasEle.width = container.clientWidth;
            }
            <span class="hljs-keyword">if</span> (dirty) {
                cvsCtx.translate(<span class="hljs-number">.5</span>, waveformHeight / <span class="hljs-number">2</span>);
                cvsCtx.scale(<span class="hljs-number">.5</span>, waveformHeight / <span class="hljs-number">256</span>);
                cvsCtx.lineWidth = <span class="hljs-number">2</span>;
            } <span class="hljs-keyword">else</span> {
                cvsCtx.setTransform(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
                cvsCtx.translate(<span class="hljs-number">.5</span>, waveformHeight / <span class="hljs-number">2</span>);
                cvsCtx.scale(<span class="hljs-number">.5</span>, waveformHeight / <span class="hljs-number">256</span>);
            }

            cvsCtx.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, canvasEle.width, canvasEle.height);
            cvsCtx.strokeStyle = <span class="hljs-string">&#x27;white&#x27;</span>;
            cvsCtx.fillStyle = <span class="hljs-string">&#x27;white&#x27;</span>;
            <span class="hljs-keyword">const</span> start = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">const</span> end = container.clientWidth;
            <span class="hljs-comment">// const end = props.waveformWidth;</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> e = start; e &lt; end; e += <span class="hljs-number">1</span>) {
                <span class="hljs-comment">// const ptr = 2 * (e % props.waveformWidth);</span>
                <span class="hljs-keyword">const</span> ptr = <span class="hljs-number">2</span> * (e % container.clientWidth);
                <span class="hljs-keyword">let</span> xPos = <span class="hljs-number">2</span> * (e - start);
                <span class="hljs-keyword">let</span> top = peaks[ptr + <span class="hljs-number">1</span>];
                <span class="hljs-keyword">let</span> bottom = peaks[ptr];
                <span class="hljs-keyword">if</span> (top &gt;= -<span class="hljs-number">.5</span> &amp;&amp; bottom &lt;= <span class="hljs-number">.5</span>) {
                    <span class="hljs-keyword">const</span> i = xPos;
                    <span class="hljs-keyword">for</span> (; e &lt; end; e += <span class="hljs-number">1</span>) {
                        <span class="hljs-comment">// const a = 2 * (e % props.waveformWidth);</span>
                        <span class="hljs-keyword">const</span> a = <span class="hljs-number">2</span> * (e % container.clientWidth);
                        <span class="hljs-keyword">if</span> (peaks[a + <span class="hljs-number">1</span>] &lt; -<span class="hljs-number">.5</span> || peaks[a] &gt; <span class="hljs-number">.5</span>) {
                            e -= <span class="hljs-number">1</span>;
                            <span class="hljs-keyword">break</span>;
                        }
                        xPos = <span class="hljs-number">2</span> * (e - start);
                    }
                    <span class="hljs-keyword">if</span> (i === xPos) {
                        cvsCtx.moveTo(xPos, -<span class="hljs-number">.5</span>);
                        cvsCtx.lineTo(xPos, <span class="hljs-number">.5</span>);
                    } <span class="hljs-keyword">else</span> {
                        cvsCtx.stroke();
                        cvsCtx.lineWidth = <span class="hljs-number">1</span>;
                        cvsCtx.beginPath();
                        cvsCtx.moveTo(i - <span class="hljs-number">.5</span>, <span class="hljs-number">0</span>);
                        cvsCtx.lineTo(xPos + <span class="hljs-number">.5</span>, <span class="hljs-number">0</span>);
                        cvsCtx.stroke();
                        cvsCtx.lineWidth = <span class="hljs-number">2</span>;
                        cvsCtx.beginPath();
                    }
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">if</span> (top &gt; -<span class="hljs-number">0.5</span>) {
                        top = -<span class="hljs-number">0.5</span>;
                    }
                    <span class="hljs-keyword">if</span> (bottom &lt; <span class="hljs-number">0.5</span>) {
                        bottom = <span class="hljs-number">0.5</span>;
                    }
                    cvsCtx.moveTo(xPos, top);
                    cvsCtx.lineTo(xPos, bottom);
                }
            }
            cvsCtx.stroke();
        }
    }
}
</code></pre>
<p>Besides, there is also a mini music player in Box3 editor implemented in a similar way.</p>
<div class='m-5'></div>
<img src="/images/audio-adjust/mini-player.gif" alt="mini audio player" style="width:320px; margin:auto"/>
<div class='m-5'></div></div></article><div class="layout_backToHome__1vZsp"><a href="/">← Back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"audio-adjust-tool","contentHtml":"\u003cdiv class='markdown'\u003e\u003c/div\u003e\n\u003ch1 class=\"text-3xl font-medium mb-2 mt-3\"\u003eAudio Adjustment Tool Of Box3 Game Editor\u003c/h1\u003e\n\u003cdiv class='m-5'\u003e\u003c/div\u003e\n\u003cimg src=\"/images/audio-adjust/audio-upload.gif\" alt=\"audio upload\" style=\"width:400px; margin:auto\"/\u003e\n\u003cdiv class='m-5'\u003e\u003c/div\u003e\n\u003cp\u003eThis is a tool for uploading and simply processing audio in the box3 game editor. I have written a component specifically for this functionality, which in addition to React, will also involve the WebAudio API and canvas 2d.\u003c/p\u003e\n\u003cdiv class='m-5'\u003e\u003c/div\u003e\n\u003cp\u003eThe main functions of this component include: playing and pausing audio, cropping audio, and providing convenient UI controls and visual feedback for these functions.\u003c/p\u003e\n\u003cdiv class='m-5'\u003e\u003c/div\u003e\n\u003cp\u003eFor those who are not familiar with WebAudio API. All you need to know is the ‘Audio’ we talk about is actually a kind of data buffer that we call \u003ccode class='il'\u003eAudioBuffer\u003c/code\u003e. Whether it’s playing or cropping or even adding sound effects, it’s all about the buffer in the end.\u003c/p\u003e\n\u003cdiv class='m-5'\u003e\u003c/div\u003e\n\u003cp\u003eTo play an audioBuffer, we need to create an \u003ccode class='il'\u003eAudioBufferSourceNode\u003c/code\u003e, be noticed, an AudioBufferSourceNode can only be started and stop once. Otherwise, your javascript engine gonna throw an error.\u003c/p\u003e\n\u003cdiv class='m-5'\u003e\u003c/div\u003e\n\u003cp\u003eNow we clear that we need to implement a class to handle all the operations to the audioBuffer and a React component to handle UI interaction.\u003c/p\u003e\n\u003cdiv class='m-5'\u003e\u003c/div\u003e\n\u003cp\u003eWe can call that  class ‘AudioPlayer’, it needs to support basic \u003ccode class='il'\u003eplay\u003c/code\u003e and \u003ccode class='il'\u003estop\u003c/code\u003e, besides, the user may want to start playback from any position of the audio, and the selected interval should support loop playback.\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"language-TypeScript\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eAudioPlayer\u003c/span\u003e \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e _state = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;stopped\u0026#x27;\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e _offset = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e _startTime = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e _finished = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e audioBuffer:AudioBuffer,\n        \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e audioContext:AudioContext\u003c/span\u003e)\u003c/span\u003e {\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e _loopStart = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eset\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eloopStart\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003evalue:\u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e\u003c/span\u003e) {\n        ...\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e _loopEnd = \u003cspan class=\"hljs-literal\"\u003eInfinity\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eset\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eloopEnd\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003evalue:\u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e\u003c/span\u003e) {\n        ...\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e _loop = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eset\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eloop\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eflag:\u003cspan class=\"hljs-built_in\"\u003eboolean\u003c/span\u003e\u003c/span\u003e) {\n        \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._loop = flag;\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e _source:AudioBufferSourceNode|\u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003enow\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.audioContext.currentTime;\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003estart\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003estartTime?:\u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e, offset?:\u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e\u003c/span\u003e)\u003c/span\u003e {\n        ...\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eget\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003estate\u003c/span\u003e() {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._state;\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eget\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003efinished\u003c/span\u003e() {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._finished;\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003estop\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003etime?:\u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e\u003c/span\u003e)\u003c/span\u003e {\n        ...\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eseek\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eoffset:\u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e, time:\u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e\u003c/span\u003e)\u003c/span\u003e {\n        ...\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe start method receives two optional params, \u003ccode class='il'\u003estartTime\u003c/code\u003e refer to the global time of ‘AudioContex’, if you want to start at the time you call the method, just pass  \u003ccode class='il'\u003eaudioContext.currentTime\u003c/code\u003e to it. \u003ccode class='il'\u003eoffset\u003c/code\u003e refers to the duration of the audio. If an audio is 1.5s long and you want to start playback from the 0.5s, then the \u003ccode class='il'\u003eoffset\u003c/code\u003e is 0.5 .\u003c/p\u003e\n\u003cp\u003eHere is how I implement the \u003ccode class='il'\u003estart\u003c/code\u003e and \u003ccode class='il'\u003estop\u003c/code\u003emethod:\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"language-TypeScript\"\u003e\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003estart\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003estartTime?:\u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e, offset?:\u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e\u003c/span\u003e)\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (startTime === \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e) {\n        startTime = \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.now();\n    }\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (offset === \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._loop) {\n            offset = \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._loopStart;\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            offset = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n        }\n    }\n    \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._source = \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.audioContext.createBufferSource();\n    \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._source.connect(\u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.audioContext.destination);\n    \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._source.buffer = \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.audioBuffer;\n    \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._source.onended = \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e now = \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.now();\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!\u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._loop) {\n            \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e passTime = (now - \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._startTime + \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._offset);\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (passTime \u0026gt;= \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.audioBuffer.duration) {\n                \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._finished = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n            } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.audioBuffer.duration - passTime \u0026gt;= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u0026amp;\u0026amp;\n                        \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.audioBuffer.duration - passTime \u0026lt;= \u003cspan class=\"hljs-number\"\u003e1e-4\u003c/span\u003e) {\n                \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._finished = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n            }\n        }\n    };\n    \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._source.loop = \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._loop;\n    \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._source.loopStart = \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._loopStart;\n    \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._source.loopEnd = \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.min(\u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._loopEnd, \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.audioBuffer.duration);\n    \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._state = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;started\u0026#x27;\u003c/span\u003e;\n    \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._source.start(startTime, offset);\n    \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._offset = offset;\n    \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._startTime = startTime;\n}\n\n\u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003estop\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003etime?:\u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e\u003c/span\u003e)\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (time === \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e) {\n        time = \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.now();\n    }\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._source) {\n        \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._source.stop(time);\n        \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._source.disconnect();\n        \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e._state = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;stopped\u0026#x27;\u003c/span\u003e;\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAs for the \u003ccode class='il'\u003eseek\u003c/code\u003e, you can simply call \u003ccode class='il'\u003estop\u003c/code\u003e then call \u003ccode class='il'\u003estart\u003c/code\u003e in it.\u003c/p\u003e\n\u003ch2 class=\"text-xl font-medium mb-2 mt-3\"\u003eDrawing the Waveform\u003c/h2\u003e\n\u003cp\u003eDrawing the waveform of audiobuffer is fairly easy. You don’t need to install another package to do it, all you need to do is some simple calculation. Many people like to install a bunch of extra modules to solve a small problem, but I prefer not to install them if I don’t need to. This allows you to keep your code light weight, and you can learn a lot of new things in the process.\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"language-TypeScript\"\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ecomputeWaveForm\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003econtainer:HTMLDivElement, buffer:AudioBuffer\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e peaks:\u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e[] = [];\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e chann0 = (buffer.getChannelData(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eArrayBuffer\u003c/span\u003e);\n    \u003cspan class=\"hljs-comment\"\u003e// const sampleSize = props.buffer.length / props.waveformWidth;\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e sampleSize = buffer.length / container.clientWidth;\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e sampleStep = ~~(sampleSize / \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e) || \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; i \u0026lt; container.clientWidth; i++) {\n    \u003cspan class=\"hljs-comment\"\u003e// for (let i = 0; i \u0026lt; props.waveformWidth; i++) {\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e start = ~~(i * sampleSize);\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e end = ~~(start + sampleSize);\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e topCount = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e bottomCount = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e bottom = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e top = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e j = start; j \u0026lt; end; j += sampleStep) {\n            \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e value = chann0[j];\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (value \u0026gt; \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n                bottom += value * value;\n                bottomCount++;\n            }\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (value \u0026lt; \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n                top += value * value;\n                topCount++;\n            }\n        }\n        peaks[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e * i] = \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.sqrt(bottom / bottomCount) * \u003cspan class=\"hljs-number\"\u003e256\u003c/span\u003e;\n        peaks[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e * i + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e] = -\u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.sqrt(top / topCount) * \u003cspan class=\"hljs-number\"\u003e256\u003c/span\u003e;\n    }\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e peaks;\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edrawWaveForm\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecanvasEle:HTMLCanvasElement, container:HTMLDivElement, peaks:\u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e[], waveformHeight:\u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (canvasEle \u0026amp;\u0026amp; container) {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e cvsCtx = canvasEle.getContext(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;2d\u0026#x27;\u003c/span\u003e);\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (cvsCtx) {\n            \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e dirty = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (canvasEle.height !== waveformHeight) {\n                dirty = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n                canvasEle.style.height = waveformHeight + \u003cspan class=\"hljs-string\"\u003e\u0026#x27;px\u0026#x27;\u003c/span\u003e;\n                canvasEle.height = waveformHeight;\n            }\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (canvasEle.width !== container.clientWidth) {\n                dirty = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n                canvasEle.style.width = container.clientWidth + \u003cspan class=\"hljs-string\"\u003e\u0026#x27;px\u0026#x27;\u003c/span\u003e;\n                canvasEle.width = container.clientWidth;\n            }\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (dirty) {\n                cvsCtx.translate(\u003cspan class=\"hljs-number\"\u003e.5\u003c/span\u003e, waveformHeight / \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\n                cvsCtx.scale(\u003cspan class=\"hljs-number\"\u003e.5\u003c/span\u003e, waveformHeight / \u003cspan class=\"hljs-number\"\u003e256\u003c/span\u003e);\n                cvsCtx.lineWidth = \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e;\n            } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n                cvsCtx.setTransform(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n                cvsCtx.translate(\u003cspan class=\"hljs-number\"\u003e.5\u003c/span\u003e, waveformHeight / \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\n                cvsCtx.scale(\u003cspan class=\"hljs-number\"\u003e.5\u003c/span\u003e, waveformHeight / \u003cspan class=\"hljs-number\"\u003e256\u003c/span\u003e);\n            }\n\n            cvsCtx.clearRect(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, canvasEle.width, canvasEle.height);\n            cvsCtx.strokeStyle = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;white\u0026#x27;\u003c/span\u003e;\n            cvsCtx.fillStyle = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;white\u0026#x27;\u003c/span\u003e;\n            \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e start = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n            \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e end = container.clientWidth;\n            \u003cspan class=\"hljs-comment\"\u003e// const end = props.waveformWidth;\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e e = start; e \u0026lt; end; e += \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) {\n                \u003cspan class=\"hljs-comment\"\u003e// const ptr = 2 * (e % props.waveformWidth);\u003c/span\u003e\n                \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e ptr = \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e * (e % container.clientWidth);\n                \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e xPos = \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e * (e - start);\n                \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e top = peaks[ptr + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e];\n                \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e bottom = peaks[ptr];\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (top \u0026gt;= -\u003cspan class=\"hljs-number\"\u003e.5\u003c/span\u003e \u0026amp;\u0026amp; bottom \u0026lt;= \u003cspan class=\"hljs-number\"\u003e.5\u003c/span\u003e) {\n                    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e i = xPos;\n                    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (; e \u0026lt; end; e += \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) {\n                        \u003cspan class=\"hljs-comment\"\u003e// const a = 2 * (e % props.waveformWidth);\u003c/span\u003e\n                        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e a = \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e * (e % container.clientWidth);\n                        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (peaks[a + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e] \u0026lt; -\u003cspan class=\"hljs-number\"\u003e.5\u003c/span\u003e || peaks[a] \u0026gt; \u003cspan class=\"hljs-number\"\u003e.5\u003c/span\u003e) {\n                            e -= \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n                            \u003cspan class=\"hljs-keyword\"\u003ebreak\u003c/span\u003e;\n                        }\n                        xPos = \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e * (e - start);\n                    }\n                    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (i === xPos) {\n                        cvsCtx.moveTo(xPos, -\u003cspan class=\"hljs-number\"\u003e.5\u003c/span\u003e);\n                        cvsCtx.lineTo(xPos, \u003cspan class=\"hljs-number\"\u003e.5\u003c/span\u003e);\n                    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n                        cvsCtx.stroke();\n                        cvsCtx.lineWidth = \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n                        cvsCtx.beginPath();\n                        cvsCtx.moveTo(i - \u003cspan class=\"hljs-number\"\u003e.5\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n                        cvsCtx.lineTo(xPos + \u003cspan class=\"hljs-number\"\u003e.5\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n                        cvsCtx.stroke();\n                        cvsCtx.lineWidth = \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e;\n                        cvsCtx.beginPath();\n                    }\n                } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n                    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (top \u0026gt; -\u003cspan class=\"hljs-number\"\u003e0.5\u003c/span\u003e) {\n                        top = -\u003cspan class=\"hljs-number\"\u003e0.5\u003c/span\u003e;\n                    }\n                    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (bottom \u0026lt; \u003cspan class=\"hljs-number\"\u003e0.5\u003c/span\u003e) {\n                        bottom = \u003cspan class=\"hljs-number\"\u003e0.5\u003c/span\u003e;\n                    }\n                    cvsCtx.moveTo(xPos, top);\n                    cvsCtx.lineTo(xPos, bottom);\n                }\n            }\n            cvsCtx.stroke();\n        }\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBesides, there is also a mini music player in Box3 editor implemented in a similar way.\u003c/p\u003e\n\u003cdiv class='m-5'\u003e\u003c/div\u003e\n\u003cimg src=\"/images/audio-adjust/mini-player.gif\" alt=\"mini audio player\" style=\"width:320px; margin:auto\"/\u003e\n\u003cdiv class='m-5'\u003e\u003c/div\u003e","title":"Audio Adjustment Tool","pic":"/images/audio-adjust/1.png","keyword":"React, WebAudio API, Canvas","description":"This is a tool for uploading and simply processing audio in the box3 platform. The technology used is React and WebAudio API.","date":"2020-08-10"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"audio-adjust-tool"},"buildId":"iKjY_zXKM7MmXYbJPJTKf","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-feb8a7604fa7fce626b2.js"></script><script src="/_next/static/chunks/main-fcbdb94e906b93a1f560.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.9d524150d48315f49e80.js" async=""></script><script src="/_next/static/chunks/7a55d4b5.210d3c80a2b0e2401248.js" async=""></script><script src="/_next/static/chunks/commons.ff0a5790a80e83d7223b.js" async=""></script><script src="/_next/static/chunks/pages/_app-5d53db12a2c7a352dba7.js" async=""></script><script src="/_next/static/chunks/df27990eef8845831ef4a3353c0adb327953b68f.b37cb412c978ebbef724.js" async=""></script><script src="/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.a80097bea88316e5b19e.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-dd642f1262e5265a6db6.js" async=""></script><script src="/_next/static/iKjY_zXKM7MmXYbJPJTKf/_buildManifest.js" async=""></script><script src="/_next/static/iKjY_zXKM7MmXYbJPJTKf/_ssgManifest.js" async=""></script></body></html>