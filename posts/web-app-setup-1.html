<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="description" content="Francis Tao-Jinjin Next.js GitHub Pages"/><meta property="og:image" content="https://og-image.now.sh/Francis%20Tao-Jinjin%20Next.js%20GitHub%20Pages.png?theme=light&amp;md=0&amp;fontSize=75px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><meta name="og:title" content="Francis Tao-Jinjin Next.js GitHub Pages"/><meta name="teitter:card" content="summary_large_image"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/default.min.css"/><title>WebApp setup from scratch</title><meta name="next-head-count" content="9"/><link rel="preload" href="/_next/static/css/525ade0da8ac601406c9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/525ade0da8ac601406c9.css" data-n-g=""/><link rel="preload" href="/_next/static/css/5becdbcfc90fd0f7b1ef.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5becdbcfc90fd0f7b1ef.css" data-n-g=""/><link rel="preload" href="/_next/static/css/230b7ec8cac95abf8a71.css" as="style"/><link rel="stylesheet" href="/_next/static/css/230b7ec8cac95abf8a71.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-b6d312587e2afb5b7e03.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.9d524150d48315f49e80.js" as="script"/><link rel="preload" href="/_next/static/chunks/7a55d4b5.210d3c80a2b0e2401248.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.0a849237534e67e84d9a.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-5606e023d1fe164dc1fd.js" as="script"/><link rel="preload" href="/_next/static/chunks/df27990eef8845831ef4a3353c0adb327953b68f.6ebe35bf6c0aadc1eb95.js" as="script"/><link rel="preload" href="/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.a80097bea88316e5b19e.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bid%5D-67fc6c234c356062955a.js" as="script"/></head><body><div id="__next"><div><div class="layout_container__2t4v2"><header class="layout_header__2rhWq"><a href="/"><img src="/images/profile.png" class="layout_headerImage__2h5On utils_borderCircle__13qdJ" alt="Francis Tao"/></a><h2 class="utils_headingLg__de7p0"><a class="utils_colorInherit__3Gudf" href="/">Francis Tao</a></h2></header><article><h1 class="utils_headingXl__1XecN">WebApp setup from scratch</h1><div class="utils_lightText__12Ckm"><time dateTime="2019-02-23">February 23, 2019</time></div><div><div class='markdown'></div>
<h1 class="text-3xl font-medium mb-2 mt-3">How to setup a web application project on your own?</h1>
<p>The repo of this blog is at <a class='text-blue-500' href="https://github.com/Francis-Tao-jinjin/web-app-setup/tree/stage-1">web-app-setup-stage-1</a>. You may want to read this article while reading the code.</p>
<p>When you Google how to create a react app, almost all the results you find will say, create a react app with ‘create-react-app’, and this is pretty much the same for angularjs and vuejs.</p>
<p>I find this situation is hard to say. I don’t mean to say that these tools are bad, but on the contrary, create-react-app can save a lot of valuable time for someone who wants to quickly learn how to use Reactjs.</p>
<p>But in the real world of development, I believe very few people are using create-react-app to build their company’s web applications. When you need to develop a complex project that integrates database, server and front-end, create-react-app feels like a toy.</p>
<p>In addition to this reason, it is also important for developers to have a general understanding of how the application is built. Otherwise, according to this trend, it is not surprising that a front-end developer end up only know html-related stuff.</p>
<p>Back to the point, let’s start thinking how to setup a web application project.</p>
<p>Simply put, a web application requires at least one server and one clients, we can design the server to be very simple, for example, all it does is to return the html page and js and css file when user make a request. In our case, the server is written in nodejs, and the front end code is using React. In order to build React app, we also need webpack as build tool.</p>
<h2 class="text-2xl font-medium mb-2 mt-3">Build Tool Setup</h2>
<p>Let’s get started.</p>
<p>1 . Create a folder and excute <code>npm init</code>, then create src folder.</p>
<p>2 . Inside ‘src’ folder, create ‘app’ folder and ‘bin’ folder. The ‘app’ folder will conatin all the code of frontend and the server. ‘bin’ folder will contain all the code that relate to build process.</p>
<p>Next, we are going to write our build tool and create a simple frontend entry file.</p>
<p>3 . install package, here are the packages we need at this step:</p>
<div class='preCodeBlock'></div>
<pre><code class="language-json">&quot;@types/fs-extra&quot;: &quot;^9.0.6&quot;,
&quot;@types/node&quot;: &quot;^10.14.6&quot;,
&quot;@types/react&quot;: &quot;^17.0.0&quot;,
&quot;@types/react-dom&quot;: &quot;^17.0.0&quot;,
&quot;autoprefixer&quot;: &quot;^9.8.6&quot;,
&quot;css-loader&quot;: &quot;^5.0.1&quot;,
&quot;dotenv&quot;: &quot;^8.2.0&quot;,
&quot;fs-extra&quot;: &quot;^9.1.0&quot;,
&quot;postcss&quot;: &quot;^7.0.35&quot;,
&quot;mini-css-extract-plugin&quot;: &quot;^0.8.0&quot;,
&quot;postcss-color-function&quot;: &quot;^4.0.1&quot;,
&quot;postcss-loader&quot;: &quot;^3.0.0&quot;,
&quot;postcss-modules-values&quot;: &quot;^3.0.0&quot;,
&quot;postcss-px-to-viewport&quot;: &quot;^0.0.3&quot;,
&quot;react&quot;: &quot;17.0.1&quot;,
&quot;react-dom&quot;: &quot;17.0.1&quot;,
&quot;style-loader&quot;: &quot;^2.0.0&quot;,
&quot;ts-loader&quot;: &quot;^8.0.15&quot;,
&quot;ts-node&quot;: &quot;^6.2.0&quot;,
&quot;typescript&quot;: &quot;~3.7.2&quot;,
&quot;webpack&quot;: &quot;4.42.1&quot;,
</code></pre>
<p>A short description, I write down the version of these package because packages like ‘webpack’, ‘postcss-loader’ and ‘css-loader’ need be some specific version to be compatible with each other. If you upgrade webpack or postcss-loader to the latest version, you will always find one or the other problem when you build the project. This situation is really terrible, which is why I think it’s important to be able to create your own projects. Because you will know the details of each step are, and thus ensure the overall stability.</p>
<p>We have webpack installed, but not webpack-cli, because we will use our own nodejs script to call webapck to compile and package the app. You may wonder why we do this, because in practice we may want to perform some additional tasks before the code is compiled, or we may want to make additional changes to the compilation results during the webpack compilation process, in short, webpack may be only part of the compilation and packaging process, but not the whole thing. (Later, when we use IPFS in a project, IPFS will be greatly involved in the process of code compilation.)</p>
<p>under ‘/src/bin’ folder, create this files:</p>
<div class='preCodeBlock'></div>
<pre><code>bin
├── watch.ts
└── utils
    ├── paths.ts
    ├── watch-webpack.js
    ├── webpack-args.ts
    └── webpack.js
</code></pre>
<p>Now let’s talk about the role of each file.</p>
<p>1 . <code>bin/watch.ts</code> is the entry file when we excute <code>npm run watch</code>, it takes the arguments we pass in from the command line, generates the webpack config with those arguments, and spawns a child-process to run <code>/bin/utils/watch-webpack.js</code>.</p>
<p>2 . <code>bin/utils/paths.ts</code> export the path name of directory such as ‘build’, ‘public’.</p>
<p>3 . <code>bin/utils/webpack-args.ts</code> define the entryPoints of frontend code and environment info :</p>
<div class='preCodeBlock'></div>
<pre><code class="language-typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> WEBPACK_CONFIG = {
    <span class="hljs-string">&#x27;all&#x27;</span>: [{
            <span class="hljs-attr">env</span>: <span class="hljs-string">&#x27;development&#x27;</span>,
            <span class="hljs-attr">entryPoints</span>: { <span class="hljs-attr">app</span>: <span class="hljs-string">&#x27;./src/app/start-client.ts&#x27;</span> },
        },
        {
            <span class="hljs-attr">env</span>: <span class="hljs-string">&#x27;production&#x27;</span>,
            <span class="hljs-attr">entryPoints</span>: { <span class="hljs-attr">app</span>: <span class="hljs-string">&#x27;./src/app/start-client.ts&#x27;</span> },
    }],
    <span class="hljs-string">&#x27;dev&#x27;</span>: [{
            <span class="hljs-attr">env</span>: <span class="hljs-string">&#x27;development&#x27;</span>,
            <span class="hljs-attr">entryPoints</span>: { <span class="hljs-attr">app</span>: <span class="hljs-string">&#x27;./src/app/start-client.ts&#x27;</span> },
    }],
    <span class="hljs-string">&#x27;prod&#x27;</span>: [{
            <span class="hljs-attr">env</span>: <span class="hljs-string">&#x27;production&#x27;</span>,
            <span class="hljs-attr">entryPoints</span>: { <span class="hljs-attr">app</span>: <span class="hljs-string">&#x27;./src/app/start-client.ts&#x27;</span> },
    }],
};
</code></pre>
<p>The env and entryPoints data will be pass to webpack config builder. You may find the whole compilation process a bit complicated and unreasonable. However, if you have more than one front-end project in your project. Each project has its own development environment and production environment, then it becomes very convenient to be able to choose by entering commands in your terminal.</p>
<p>4 . <code>bin/utils/webpackpack.js</code> responsible for generating the webpack config object and exporting the functions that call webpack(configs).watch,</p>
<p>5 . <code>bin/utils/watch-webpack.js</code> call the watch function which exported from ‘bin/utils/webpackpack.js’.</p>
<p>Then we need to focus on <code>bin/utils/webpackpack.js</code>. Because we are using typescript and react, we need to use <code>ts-node</code> in the module, since we are using css module, we also need use <code>MiniCssExtractPlugin</code>, <code>css-loader</code> and <code>postcss-loader</code>. Usually, we would set the localIdentName option in the css-loader so that the classname in the css file imported by the tsx module will be a unique string after compilation. However, for some third-party css frameworks, this will not work because the css code in those frameworks should not be modified and all the class name should be preserved.
The most obvious example of this is <b>Tailwindcss</b>. I will talk more about how to install Tailwindcss correctly later.</p>
<p>Next, export the <code>watchWebpack</code> function, In this function, we manually call webapck.watch to compile and keep watch the file change.</p>
<p>This is what the function looks lik:</p>
<div class='preCodeBlock'></div>
<pre><code class="language-typescript"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">watchWebpack</span>(<span class="hljs-params">specs</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> compiler = webpack(specs.map(getWebpackConfig));
        compiler.hooks.watchRun.tap(<span class="hljs-string">&#x27;WatchReportChangePlugin&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
            logger.log(<span class="hljs-string">`webpack detected change...`</span>);
        });
        compiler.hooks.invalid.tap(<span class="hljs-string">&#x27;WatchReportChangePlugin&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">fileName</span>) =&gt;</span> {
            logger.log(<span class="hljs-string">`webpack change detected to <span class="hljs-subst">${fileName}</span>`</span>);
        });
        <span class="hljs-keyword">const</span> opts = {
            <span class="hljs-attr">aggregateTimeout</span>: <span class="hljs-number">1000</span>,
            <span class="hljs-attr">poll</span>: <span class="hljs-literal">undefined</span>,
            <span class="hljs-attr">ignored</span>: [],
        };
        <span class="hljs-keyword">let</span> hasCompleted = <span class="hljs-literal">false</span>;
        compiler.watch(opts, <span class="hljs-function">(<span class="hljs-params">err, stats</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (err) {
                logger.error(<span class="hljs-string">`web pack error: <span class="hljs-subst">${err.message}</span> <span class="hljs-subst">${err.stack}</span>`</span>);
                <span class="hljs-keyword">if</span> (!hasCompleted) {
                    reject(err);
                    hasCompleted = <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-keyword">if</span> (!hasCompleted) {
                resolve();  
                hasCompleted = <span class="hljs-literal">true</span>;
            }
        });
    });
}
</code></pre>
<h2 class="text-2xl font-medium mb-2 mt-3">Write Some Frontend Code</h2>
<p>After setup the build tool, we can create some front-end code to test that our packaging tool is working properly. Under <code>/src/app</code>, let’s create these file:</p>
<div class='preCodeBlock'></div>
<pre><code>app
├── start-client.ts
├── client.tsx
└── frontend
    ├── index.tsx
    └── style.css
</code></pre>
<p><code>start-client.ts</code> is the frontend entry file, <code>client.tsx</code> is the start point of React. <code>/frontend/index.tsx</code> is a simple React component for demonstrate whether the css module is working or not.</p>
<p>Code in <code>start-client.ts</code>:</p>
<div class='preCodeBlock'></div>
<pre><code class="language-Typescript"><span class="hljs-keyword">import</span> { FrontendClient } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./client&#x27;</span>;
<span class="hljs-keyword">import</span> { LogLevel } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils/logger&#x27;</span>;
<span class="hljs-keyword">import</span> { createLogger } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./logger&#x27;</span>;

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">go</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">const</span> logger = createLogger({
        <span class="hljs-attr">logLevel</span>: LogLevel.DEBUG,
        <span class="hljs-attr">logPrefixRegex</span>: <span class="hljs-string">&#x27;&#x27;</span>,
    });
    <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> FrontendClient({
        logger,
    });

    client.start();
}

go().catch(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">&#x27;frontend client start error&#x27;</span>);
    <span class="hljs-built_in">console</span>.error(e);
});
</code></pre>
<p>and this is the code in <code>client.tsx</code></p>
<div class='preCodeBlock'></div>
<pre><code class="language-Typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span>;
<span class="hljs-keyword">import</span> { Logger } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils/logger&#x27;</span>;
<span class="hljs-keyword">import</span> { FrontendUI } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./frontend&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FrontendClient</span> </span>{
    <span class="hljs-keyword">public</span> logger:Logger;
    <span class="hljs-keyword">private</span> rootDiv:HTMLDivElement;

    <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params">spec:{
        logger:Logger,
    }</span>)</span> {
        <span class="hljs-built_in">this</span>.logger = spec.logger;
        <span class="hljs-built_in">this</span>.rootDiv = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;div&#x27;</span>);
        <span class="hljs-built_in">this</span>.rootDiv.style.left = <span class="hljs-string">&#x27;0&#x27;</span>;
        <span class="hljs-built_in">this</span>.rootDiv.style.right = <span class="hljs-string">&#x27;0&#x27;</span>;
        <span class="hljs-built_in">document</span>.body.appendChild(<span class="hljs-built_in">this</span>.rootDiv);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-title">start</span>(<span class="hljs-params"></span>)</span> {
        <span class="hljs-built_in">this</span>.render();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-title">render</span>(<span class="hljs-params"></span>)</span> {
        ReactDOM.render(
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">FrontendUI</span>
                <span class="hljs-attr">client</span>=<span class="hljs-string">{this}</span>
            &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">FrontendUI</span>&gt;</span></span>,
            <span class="hljs-built_in">this</span>.rootDiv,
        );
    }
}
</code></pre>
<p>The reason we use <code>start-client.ts</code> as entry file instead of ‘.tsx’ file is, before we render the page, we may need to do some preparations, such as initializing the websocket, register RPC protocol or connect to the backend system.</p>
<p>After we setup the frontend code, we can try to compile the code with our build tool, add this line to your <code>package.json</code>’s scripts scope:</p>
<div class='preCodeBlock'></div>
<pre><code>&quot;watch&quot;: &quot;TS_NODE_PROJECT=node.tsconfig.json ts-node src/bin/watch.ts&quot;
</code></pre>
<p>Then, just type <code>npm run watch</code>, you should see some log about the compilation process are printed in the terminal. In few seconds, a ‘build’ folder will be created in the root directory, which contain the compiled files.</p>
<p>Now that we have configured webpack and ensured that the cssModule works,  let’s see how to make tailwind work as well. Currently, the webpack conifg’s module scope looks like this:</p>
<div class='preCodeBlock'></div>
<pre><code class="language-Javascript"><span class="hljs-built_in">module</span>: {
    <span class="hljs-attr">rules</span>: [
        {
            <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.tsx?$/</span>,
            use: [
                {
                    <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;ts-loader&#x27;</span>,
                    <span class="hljs-attr">options</span>: {
                        <span class="hljs-attr">configFile</span>: path.join(ROOT, <span class="hljs-string">&#x27;client.tsconfig.json&#x27;</span>),
                    },
                },
            ],
            <span class="hljs-attr">include</span>: SRC,
        },
        {
            <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,
            include: SRC,
            <span class="hljs-attr">use</span>: [
                {
                    <span class="hljs-attr">loader</span>: MiniCssExtractPlugin.loader,
                },
                {
                    <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;css-loader&#x27;</span>,
                    <span class="hljs-attr">options</span>: {
                        <span class="hljs-attr">modules</span>: {
                            <span class="hljs-attr">localIdentName</span>: isDev
                                ? <span class="hljs-string">&#x27;[path][name]__[local]--[hash:base64:5]&#x27;</span>
                                : <span class="hljs-string">&#x27;[hash:base64]&#x27;</span>,
                        },
                        <span class="hljs-attr">importLoaders</span>: <span class="hljs-number">1</span>,
                        <span class="hljs-attr">url</span>: <span class="hljs-literal">false</span>,
                    },
                },
                {
                    <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;postcss-loader&#x27;</span>,
                    <span class="hljs-attr">options</span>: {
                        <span class="hljs-attr">ident</span>: <span class="hljs-string">&#x27;postcss&#x27;</span>,
                        <span class="hljs-attr">plugins</span>: [
                            cssValues,
                            autoPrefixerPlugin,
                        ],
                    },
                },
            ],
        },
    ],
}
</code></pre>
<p>Noticed, in the options of <code>css-loader</code>, we have config the localIdentName, css Module have no problem with this, but it’s not true with Tailwind css. We can think of tailwind css as a global css framework, all we need to do is to concat its css code to our final code without any modification. From the Tailwind Installation instruction, here are the thing we need to do:</p>
<p>1 . install package, once again, I will give the specific version. Since we already have autoprefixer installed, we don’t need to install it agian.</p>
<div class='preCodeBlock'></div>
<pre><code>&quot;@tailwindcss/postcss7-compat&quot;: &quot;^2.0.2&quot;,
&quot;tailwindcss&quot;: &quot;npm:@tailwindcss/postcss7-compat@^2.0.2&quot;,
</code></pre>
<p>2 . create <code>tailwind.config.js</code> and <code>postcss.config.js</code>, then fill them with these code:</p>
<div class='preCodeBlock'></div>
<pre><code class="language-javascript"><span class="hljs-comment">// tailwind.config.js</span>
<span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">purge</span>: [<span class="hljs-string">&#x27;./src/**/*.{js,jsx,ts,tsx}&#x27;</span>, <span class="hljs-string">&#x27;./public/index.html&#x27;</span>],
  <span class="hljs-attr">darkMode</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// or &#x27;media&#x27; or &#x27;class&#x27;</span>
  <span class="hljs-attr">theme</span>: {
    <span class="hljs-attr">extend</span>: {},
  },
  <span class="hljs-attr">variants</span>: {
    <span class="hljs-attr">extend</span>: {},
  },
  <span class="hljs-attr">plugins</span>: [],
}

<span class="hljs-comment">// postcss.config.js</span>
<span class="hljs-built_in">module</span>.exports = {
    <span class="hljs-attr">plugins</span>: [
        <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;autoprefixer&#x27;</span>),
        <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;tailwindcss&#x27;</span>),
    ],
};
</code></pre>
<p>Next, create <code>global.css</code> in <code>/src/app</code> folder and add these line:</p>
<div class='preCodeBlock'></div>
<pre><code>@tailwind base;
@tailwind components;
@tailwind utilities;
</code></pre>
<p>Then we need to change the webpack config a little bit, at this time, we need to test ‘css’ file twice, the first time we will skip <code>global.css</code>, the second time will only include <code>global.css</code>. So, we need to change config’s module scope to this:</p>
<div class='preCodeBlock'></div>
<pre><code class="language-javascript"><span class="hljs-built_in">module</span>: {
    <span class="hljs-attr">rules</span>: [
        {
            <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.tsx?$/</span>,
            use: [
                {
                    <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;ts-loader&#x27;</span>,
                    <span class="hljs-attr">options</span>: {
                        <span class="hljs-attr">configFile</span>: websiteTsConfig,
                    },
                },
            ],
            <span class="hljs-attr">include</span>: SRC,
        },
        {
            <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,
            include: SRC,
            <span class="hljs-attr">use</span>: [
                {
                    <span class="hljs-attr">loader</span>: MiniCssExtractPlugin.loader,
                },
                {
                    <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;css-loader&#x27;</span>,
                    <span class="hljs-attr">options</span>: {
                        <span class="hljs-attr">modules</span>: {
                            <span class="hljs-attr">localIdentName</span>: isDev
                                ? <span class="hljs-string">&#x27;[path][name]__[local]--[hash:base64:5]&#x27;</span>
                                : <span class="hljs-string">&#x27;[hash:base64]&#x27;</span>,
                        },
                        <span class="hljs-attr">importLoaders</span>: <span class="hljs-number">1</span>,
                        <span class="hljs-attr">url</span>: <span class="hljs-literal">false</span>,
                    },
                },
                {
                    <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;postcss-loader&#x27;</span>,
                    <span class="hljs-attr">options</span>: {
                        <span class="hljs-attr">ident</span>: <span class="hljs-string">&#x27;postcss&#x27;</span>,
                        <span class="hljs-attr">plugins</span>: [
                            cssValues,
                            autoPrefixerPlugin,
                        ],
                    },
                },
            ],
            <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/(global.css)/</span>,
        },
        {
            <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,
            include: <span class="hljs-regexp">/(global.css)/</span>,
            use: [{
                <span class="hljs-attr">loader</span>: MiniCssExtractPlugin.loader,
                <span class="hljs-attr">options</span>: {
                    <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&#x27;../&#x27;</span>,
                },
            },
            {
                <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;css-loader&#x27;</span>,
                <span class="hljs-attr">options</span>: {
                    <span class="hljs-attr">modules</span>: {
                        <span class="hljs-attr">localIdentName</span>: <span class="hljs-string">&#x27;[local]&#x27;</span>
                    },
                    <span class="hljs-attr">importLoaders</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-attr">url</span>: <span class="hljs-literal">false</span>,
                },
            },
            {
                <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;postcss-loader&#x27;</span>,
                <span class="hljs-attr">options</span>: {
                    <span class="hljs-attr">ident</span>: <span class="hljs-string">&#x27;postcss&#x27;</span>,
                    <span class="hljs-attr">plugins</span>: [
                        tailwindcss(<span class="hljs-string">&#x27;./tailwind.config.js&#x27;</span>),
                        cssValues,
                        autoPrefixerPlugin,
                    ],
                },
            }],
        },
    ],
},
</code></pre>
<p>Now, the tailwind css will working.</p>
<h2 class="text-2xl font-medium mb-2 mt-3">Server Setup</h2>
<p>Finally, we come to the server.</p>
<p>1 . create these file under src folder:</p>
<div class='preCodeBlock'></div>
<pre><code>src
├── app
│   └── start-server.ts
└── utils
    └── start-app
        ├── html-entry.ts
        └── server.ts
</code></pre>
<p><code>start-server.ts</code> is the entry file of our nodejs server, <code>src/utils/server.ts</code> contain some helper function and <code>src/utils/html-entry.ts</code> is responsible for build the ‘index.html’ content.</p>
<p>First, install the package: <code>npm install ip</code>, then we add ‘startServer’ and ‘createDefaultHttpHandler’ function in the <code>src/utils/server.ts</code>.</p>
<div class='preCodeBlock'></div>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;http&#x27;</span>;
<span class="hljs-keyword">import</span> ip <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;ip&#x27;</span>;
<span class="hljs-keyword">import</span> url <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;url&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> RouteHandler = <span class="hljs-function">(<span class="hljs-params">req:http.IncomingMessage, res:http.ServerResponse</span>) =&gt;</span> <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> RouteHandlers = {[path:<span class="hljs-built_in">string</span>]:RouteHandler};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">startServer</span>(<span class="hljs-params">spec: {
    port:<span class="hljs-built_in">number</span>;
    httpHandler:RouteHandler;
    start:(spec: {httpServer:http.Server}) =&gt; <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;;
    logger:Logger;
}</span>) </span>{
    <span class="hljs-keyword">const</span> logger = spec.logger;

    <span class="hljs-keyword">const</span> httpServer = http.createServer(spec.httpHandler);

    <span class="hljs-keyword">await</span> spec.start({httpServer});

    httpServer.listen(spec.port);
    <span class="hljs-keyword">const</span> address = ip.address();
    <span class="hljs-keyword">const</span> serverURL = <span class="hljs-string">`http://<span class="hljs-subst">${address}</span>:<span class="hljs-subst">${spec.port}</span>`</span>;
    logger.log(<span class="hljs-string">`server address: <span class="hljs-subst">${serverURL}</span>`</span>);
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createDefaultHttpHandler</span>(<span class="hljs-params">spec:{
    routes:RouteHandlers,
    logger:Logger,
    defaultRoute?:RouteHandler;
}</span>) : <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">RouteHandler</span>&gt; </span>{
    <span class="hljs-keyword">let</span> contentRouter;
    <span class="hljs-keyword">const</span> routes = spec.routes;
    <span class="hljs-keyword">const</span> logger = spec.logger || <span class="hljs-built_in">console</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (req:http.IncomingMessage, <span class="hljs-attr">res</span>:http.ServerResponse) =&gt; {
        res.setHeader(<span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span>, req.headers &amp;&amp; req.headers.origin || <span class="hljs-string">&#x27;*&#x27;</span>);
        res.setHeader(<span class="hljs-string">&#x27;Access-Control-Allow-Methods&#x27;</span>, <span class="hljs-string">&#x27;GET,PUT,POST,DELETE&#x27;</span>);
        res.setHeader(<span class="hljs-string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="hljs-string">&#x27;Content-Type&#x27;</span>);
        res.setHeader(<span class="hljs-string">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class="hljs-string">&#x27;true&#x27;</span>);
        <span class="hljs-keyword">if</span> (!req.url) {
            res.writeHead(<span class="hljs-number">400</span>);
            <span class="hljs-keyword">return</span> res.end(<span class="hljs-string">&#x27;url cannot be empty&#x27;</span>);
        }
        <span class="hljs-keyword">const</span> { pathname } = url.parse(req.url);
        <span class="hljs-keyword">if</span> (routes[<span class="hljs-string">&#x27;/index.html&#x27;</span>] &amp;&amp; (!pathname || <span class="hljs-regexp">/^\/?(index\.html?)?$/</span>.test(pathname))) {
            logger.debug(<span class="hljs-string">&#x27;serving generated index&#x27;</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> routes[<span class="hljs-string">&#x27;/index.html&#x27;</span>](req, res);
        }

        <span class="hljs-keyword">if</span> (pathname) {
            <span class="hljs-keyword">let</span> routeHandler = routes[pathname];
            <span class="hljs-keyword">if</span> (!routeHandler) {
                <span class="hljs-keyword">const</span> reg = pathname.match(<span class="hljs-regexp">/^\/[a-zA-Z0-9._]+/</span>);
                <span class="hljs-keyword">if</span> (reg) {
                    routeHandler = routes[reg[<span class="hljs-number">0</span>]];
                }
            }
            <span class="hljs-keyword">if</span> (routeHandler) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> routeHandler(req, res);
            }
            <span class="hljs-keyword">if</span> (pathname === <span class="hljs-string">&#x27;/healthCheck&#x27;</span>) {
                res.setHeader(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;application/json&#x27;</span>);
                res.end(<span class="hljs-string">`{status: &quot;good&quot;}`</span>);
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-keyword">if</span> (!pathname.match(<span class="hljs-regexp">/\.(js|css|html)$/</span>) &amp;&amp; spec.defaultRoute) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> spec.defaultRoute(req, res);
            }
        }
        res.writeHead(<span class="hljs-number">400</span>);
        res.end(<span class="hljs-string">&#x27;resource not found&#x27;</span>);
    }
}
</code></pre>
<p>From the code above, you should already see that we are handling the routes directly through nodejs, rather than installing a toolkit such as express. The fact is, in most of the cases, we don’t need to install express at all. It is not complicated to write a routing logic directly with nodejs.</p>
<p>In the <code>start-server.ts</code>, we add routes <code>/bundle.js</code>, <code>/bundle.css</code> and <code>/index.html</code>, we also need to create routes to handle static file request and bad request.</p>
<div class='preCodeBlock'></div>
<pre><code class="language-Typescript"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;fs&#x27;</span>;
<span class="hljs-keyword">import</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;http&#x27;</span>;
<span class="hljs-keyword">import</span> url <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;url&#x27;</span>;
<span class="hljs-keyword">import</span> util <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;util&#x27;</span>;
<span class="hljs-keyword">import</span> { config } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./config&#x27;</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> PATHS <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../bin/utils/paths&#x27;</span>;
<span class="hljs-keyword">import</span> { startServer, createDefaultHttpHandler, RouteHandlers } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils/start-app/server&#x27;</span>;
<span class="hljs-keyword">import</span> { htmlEntry } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils/start-app/html-entry&#x27;</span>;

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">go</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getHtml</span>(<span class="hljs-params">res:http.ServerResponse, htmlSpec?:<span class="hljs-built_in">object</span></span>) </span>{
        res.writeHead(<span class="hljs-number">200</span>, {
            <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/html&#x27;</span>,
            <span class="hljs-string">&#x27;Cache-Control&#x27;</span>: <span class="hljs-string">&#x27;private, no-cache, no-store, must-revalidate&#x27;</span>,
            <span class="hljs-string">&#x27;Expire&#x27;</span>: <span class="hljs-string">&#x27;-1&#x27;</span>,
            <span class="hljs-string">&#x27;Pragma&#x27;</span>: <span class="hljs-string">&#x27;no-cache&#x27;</span>,
        });
        res.end(Buffer.from(htmlEntry({
            <span class="hljs-attr">title</span>: ...,
            <span class="hljs-attr">description</span>: ...,
            <span class="hljs-attr">cssBundle</span>: <span class="hljs-string">&#x27;/bundle.css&#x27;</span>,
            <span class="hljs-attr">jsBundle</span>: <span class="hljs-string">&#x27;/bundle.js&#x27;</span>,
            <span class="hljs-attr">manifest</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">viewPort</span>: <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">bodyHtml</span>: <span class="hljs-string">&#x27;&#x27;</span>,
            <span class="hljs-attr">headHtml</span>: <span class="hljs-string">&#x27;&#x27;</span>,
        }), <span class="hljs-string">&#x27;utf8&#x27;</span>));
    }

    <span class="hljs-keyword">const</span> routes:RouteHandlers = {
        <span class="hljs-string">&#x27;/bundle.js&#x27;</span>: <span class="hljs-keyword">async</span> (req:http.IncomingMessage, <span class="hljs-attr">res</span>:http.ServerResponse) =&gt; {
            res.writeHead(<span class="hljs-number">200</span>, {
                <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/javascript&#x27;</span>,
                <span class="hljs-string">&#x27;Cache-Control&#x27;</span>: <span class="hljs-string">&#x27;private, no-cache, no-store, must-revalidate&#x27;</span>,
                <span class="hljs-string">&#x27;Expire&#x27;</span>: <span class="hljs-string">&#x27;-1&#x27;</span>,
                <span class="hljs-string">&#x27;Pragma&#x27;</span>: <span class="hljs-string">&#x27;no-cache&#x27;</span>,
            });
            fs.createReadStream(PATHS.FRONTEND_JS).pipe(res);
            <span class="hljs-keyword">return</span>;
        },
        <span class="hljs-string">&#x27;/bundle.css&#x27;</span>: <span class="hljs-keyword">async</span> (req, res) =&gt; {
            res.writeHead(<span class="hljs-number">200</span>, {
                <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/css&#x27;</span>,
                <span class="hljs-string">&#x27;Cache-Control&#x27;</span>: <span class="hljs-string">&#x27;private, no-cache, no-store, must-revalidate&#x27;</span>,
                <span class="hljs-string">&#x27;Expire&#x27;</span>: <span class="hljs-string">&#x27;-1&#x27;</span>,
                <span class="hljs-string">&#x27;Pragma&#x27;</span>: <span class="hljs-string">&#x27;no-cache&#x27;</span>,
            });
            fs.createReadStream(PATHS.FRONTEND_CSS).pipe(res);
            <span class="hljs-keyword">return</span>;
        },
        <span class="hljs-string">&#x27;/index.html&#x27;</span>: <span class="hljs-keyword">async</span> (req, res) =&gt; getHtml(res),
    };

    <span class="hljs-keyword">const</span> logger = createLogger({
        <span class="hljs-attr">logLevel</span>: config.logLevel,
        <span class="hljs-attr">logPrefixRegex</span>: config.logPrefixRegex,
    });

    <span class="hljs-keyword">await</span> startServer({
        <span class="hljs-attr">port</span>: config.port,
        <span class="hljs-attr">env</span>: config.env,
        <span class="hljs-attr">development</span>: config.env === <span class="hljs-string">&#x27;development&#x27;</span>,
        logger,
        <span class="hljs-attr">httpHandler</span>: <span class="hljs-keyword">await</span> createDefaultHttpHandler({
            <span class="hljs-attr">development</span>: config.env === <span class="hljs-string">&#x27;development&#x27;</span>,
            routes,
            logger,
            <span class="hljs-attr">defaultRoute</span>: <span class="hljs-keyword">async</span> (req:http.IncomingMessage, <span class="hljs-attr">res</span>:http.ServerResponse) =&gt; {
                <span class="hljs-keyword">if</span> (!req.url) {
                    res.writeHead(<span class="hljs-number">400</span>);
                    <span class="hljs-keyword">return</span> res.end(<span class="hljs-string">&#x27;url cannot be empty&#x27;</span>);
                }
                <span class="hljs-keyword">const</span> { pathname } = url.parse(req.url);
                <span class="hljs-keyword">const</span> publicStaticFile = PATHS.PUBLIC + pathname;
                <span class="hljs-keyword">const</span> stats = <span class="hljs-keyword">await</span> util.promisify(fs.stat)(publicStaticFile).catch(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
                    logger.error(error);
                    res.writeHead(<span class="hljs-number">400</span>);
                    res.end(<span class="hljs-string">&#x27;resource not found&#x27;</span>);
                    <span class="hljs-keyword">return</span>;
                });

                <span class="hljs-keyword">if</span> (stats &amp;&amp; stats.isFile()) {
                    fs.createReadStream(publicStaticFile).pipe(res);
                    <span class="hljs-keyword">return</span>;
                }
                <span class="hljs-keyword">return</span>;
            },
        }),
        <span class="hljs-attr">start</span>: <span class="hljs-keyword">async</span> () =&gt; {
        },
    });
}

go().catch(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">&#x27;start server error&#x27;</span>);
    <span class="hljs-built_in">console</span>.error(e);
});
</code></pre>
<p>In order to run the server, add <code>&quot;start&quot;: &quot;TS_NODE_PROJECT=node.tsconfig.json ts-node src/app/start-server.ts&quot;</code> to your package.json, then type <code>npm start</code>.</p>
<p>Now, your app is running!</p>
</div></article><div class="layout_backToHome__1vZsp"><a href="/">← Back to home</a></div><canvas></canvas></div><canvas id="glcanvas" width="1" height="1">Your browser doesn&#x27;t appear to support the HTML5 <code>&lt;canvas&gt;</code> element.</canvas></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"web-app-setup-1","contentHtml":"\u003cdiv class='markdown'\u003e\u003c/div\u003e\n\u003ch1 class=\"text-3xl font-medium mb-2 mt-3\"\u003eHow to setup a web application project on your own?\u003c/h1\u003e\n\u003cp\u003eThe repo of this blog is at \u003ca class='text-blue-500' href=\"https://github.com/Francis-Tao-jinjin/web-app-setup/tree/stage-1\"\u003eweb-app-setup-stage-1\u003c/a\u003e. You may want to read this article while reading the code.\u003c/p\u003e\n\u003cp\u003eWhen you Google how to create a react app, almost all the results you find will say, create a react app with ‘create-react-app’, and this is pretty much the same for angularjs and vuejs.\u003c/p\u003e\n\u003cp\u003eI find this situation is hard to say. I don’t mean to say that these tools are bad, but on the contrary, create-react-app can save a lot of valuable time for someone who wants to quickly learn how to use Reactjs.\u003c/p\u003e\n\u003cp\u003eBut in the real world of development, I believe very few people are using create-react-app to build their company’s web applications. When you need to develop a complex project that integrates database, server and front-end, create-react-app feels like a toy.\u003c/p\u003e\n\u003cp\u003eIn addition to this reason, it is also important for developers to have a general understanding of how the application is built. Otherwise, according to this trend, it is not surprising that a front-end developer end up only know html-related stuff.\u003c/p\u003e\n\u003cp\u003eBack to the point, let’s start thinking how to setup a web application project.\u003c/p\u003e\n\u003cp\u003eSimply put, a web application requires at least one server and one clients, we can design the server to be very simple, for example, all it does is to return the html page and js and css file when user make a request. In our case, the server is written in nodejs, and the front end code is using React. In order to build React app, we also need webpack as build tool.\u003c/p\u003e\n\u003ch2 class=\"text-2xl font-medium mb-2 mt-3\"\u003eBuild Tool Setup\u003c/h2\u003e\n\u003cp\u003eLet’s get started.\u003c/p\u003e\n\u003cp\u003e1 . Create a folder and excute \u003ccode\u003enpm init\u003c/code\u003e, then create src folder.\u003c/p\u003e\n\u003cp\u003e2 . Inside ‘src’ folder, create ‘app’ folder and ‘bin’ folder. The ‘app’ folder will conatin all the code of frontend and the server. ‘bin’ folder will contain all the code that relate to build process.\u003c/p\u003e\n\u003cp\u003eNext, we are going to write our build tool and create a simple frontend entry file.\u003c/p\u003e\n\u003cp\u003e3 . install package, here are the packages we need at this step:\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"language-json\"\u003e\u0026quot;@types/fs-extra\u0026quot;: \u0026quot;^9.0.6\u0026quot;,\n\u0026quot;@types/node\u0026quot;: \u0026quot;^10.14.6\u0026quot;,\n\u0026quot;@types/react\u0026quot;: \u0026quot;^17.0.0\u0026quot;,\n\u0026quot;@types/react-dom\u0026quot;: \u0026quot;^17.0.0\u0026quot;,\n\u0026quot;autoprefixer\u0026quot;: \u0026quot;^9.8.6\u0026quot;,\n\u0026quot;css-loader\u0026quot;: \u0026quot;^5.0.1\u0026quot;,\n\u0026quot;dotenv\u0026quot;: \u0026quot;^8.2.0\u0026quot;,\n\u0026quot;fs-extra\u0026quot;: \u0026quot;^9.1.0\u0026quot;,\n\u0026quot;postcss\u0026quot;: \u0026quot;^7.0.35\u0026quot;,\n\u0026quot;mini-css-extract-plugin\u0026quot;: \u0026quot;^0.8.0\u0026quot;,\n\u0026quot;postcss-color-function\u0026quot;: \u0026quot;^4.0.1\u0026quot;,\n\u0026quot;postcss-loader\u0026quot;: \u0026quot;^3.0.0\u0026quot;,\n\u0026quot;postcss-modules-values\u0026quot;: \u0026quot;^3.0.0\u0026quot;,\n\u0026quot;postcss-px-to-viewport\u0026quot;: \u0026quot;^0.0.3\u0026quot;,\n\u0026quot;react\u0026quot;: \u0026quot;17.0.1\u0026quot;,\n\u0026quot;react-dom\u0026quot;: \u0026quot;17.0.1\u0026quot;,\n\u0026quot;style-loader\u0026quot;: \u0026quot;^2.0.0\u0026quot;,\n\u0026quot;ts-loader\u0026quot;: \u0026quot;^8.0.15\u0026quot;,\n\u0026quot;ts-node\u0026quot;: \u0026quot;^6.2.0\u0026quot;,\n\u0026quot;typescript\u0026quot;: \u0026quot;~3.7.2\u0026quot;,\n\u0026quot;webpack\u0026quot;: \u0026quot;4.42.1\u0026quot;,\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eA short description, I write down the version of these package because packages like ‘webpack’, ‘postcss-loader’ and ‘css-loader’ need be some specific version to be compatible with each other. If you upgrade webpack or postcss-loader to the latest version, you will always find one or the other problem when you build the project. This situation is really terrible, which is why I think it’s important to be able to create your own projects. Because you will know the details of each step are, and thus ensure the overall stability.\u003c/p\u003e\n\u003cp\u003eWe have webpack installed, but not webpack-cli, because we will use our own nodejs script to call webapck to compile and package the app. You may wonder why we do this, because in practice we may want to perform some additional tasks before the code is compiled, or we may want to make additional changes to the compilation results during the webpack compilation process, in short, webpack may be only part of the compilation and packaging process, but not the whole thing. (Later, when we use IPFS in a project, IPFS will be greatly involved in the process of code compilation.)\u003c/p\u003e\n\u003cp\u003eunder ‘/src/bin’ folder, create this files:\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode\u003ebin\n├── watch.ts\n└── utils\n    ├── paths.ts\n    ├── watch-webpack.js\n    ├── webpack-args.ts\n    └── webpack.js\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow let’s talk about the role of each file.\u003c/p\u003e\n\u003cp\u003e1 . \u003ccode\u003ebin/watch.ts\u003c/code\u003e is the entry file when we excute \u003ccode\u003enpm run watch\u003c/code\u003e, it takes the arguments we pass in from the command line, generates the webpack config with those arguments, and spawns a child-process to run \u003ccode\u003e/bin/utils/watch-webpack.js\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003e2 . \u003ccode\u003ebin/utils/paths.ts\u003c/code\u003e export the path name of directory such as ‘build’, ‘public’.\u003c/p\u003e\n\u003cp\u003e3 . \u003ccode\u003ebin/utils/webpack-args.ts\u003c/code\u003e define the entryPoints of frontend code and environment info :\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e WEBPACK_CONFIG = {\n    \u003cspan class=\"hljs-string\"\u003e\u0026#x27;all\u0026#x27;\u003c/span\u003e: [{\n            \u003cspan class=\"hljs-attr\"\u003eenv\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;development\u0026#x27;\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eentryPoints\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003eapp\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;./src/app/start-client.ts\u0026#x27;\u003c/span\u003e },\n        },\n        {\n            \u003cspan class=\"hljs-attr\"\u003eenv\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;production\u0026#x27;\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eentryPoints\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003eapp\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;./src/app/start-client.ts\u0026#x27;\u003c/span\u003e },\n    }],\n    \u003cspan class=\"hljs-string\"\u003e\u0026#x27;dev\u0026#x27;\u003c/span\u003e: [{\n            \u003cspan class=\"hljs-attr\"\u003eenv\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;development\u0026#x27;\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eentryPoints\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003eapp\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;./src/app/start-client.ts\u0026#x27;\u003c/span\u003e },\n    }],\n    \u003cspan class=\"hljs-string\"\u003e\u0026#x27;prod\u0026#x27;\u003c/span\u003e: [{\n            \u003cspan class=\"hljs-attr\"\u003eenv\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;production\u0026#x27;\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eentryPoints\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003eapp\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;./src/app/start-client.ts\u0026#x27;\u003c/span\u003e },\n    }],\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe env and entryPoints data will be pass to webpack config builder. You may find the whole compilation process a bit complicated and unreasonable. However, if you have more than one front-end project in your project. Each project has its own development environment and production environment, then it becomes very convenient to be able to choose by entering commands in your terminal.\u003c/p\u003e\n\u003cp\u003e4 . \u003ccode\u003ebin/utils/webpackpack.js\u003c/code\u003e responsible for generating the webpack config object and exporting the functions that call webpack(configs).watch,\u003c/p\u003e\n\u003cp\u003e5 . \u003ccode\u003ebin/utils/watch-webpack.js\u003c/code\u003e call the watch function which exported from ‘bin/utils/webpackpack.js’.\u003c/p\u003e\n\u003cp\u003eThen we need to focus on \u003ccode\u003ebin/utils/webpackpack.js\u003c/code\u003e. Because we are using typescript and react, we need to use \u003ccode\u003ets-node\u003c/code\u003e in the module, since we are using css module, we also need use \u003ccode\u003eMiniCssExtractPlugin\u003c/code\u003e, \u003ccode\u003ecss-loader\u003c/code\u003e and \u003ccode\u003epostcss-loader\u003c/code\u003e. Usually, we would set the localIdentName option in the css-loader so that the classname in the css file imported by the tsx module will be a unique string after compilation. However, for some third-party css frameworks, this will not work because the css code in those frameworks should not be modified and all the class name should be preserved.\nThe most obvious example of this is \u003cb\u003eTailwindcss\u003c/b\u003e. I will talk more about how to install Tailwindcss correctly later.\u003c/p\u003e\n\u003cp\u003eNext, export the \u003ccode\u003ewatchWebpack\u003c/code\u003e function, In this function, we manually call webapck.watch to compile and keep watch the file change.\u003c/p\u003e\n\u003cp\u003eThis is what the function looks lik:\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ewatchWebpack\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003especs\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e compiler = webpack(specs.map(getWebpackConfig));\n        compiler.hooks.watchRun.tap(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;WatchReportChangePlugin\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n            logger.log(\u003cspan class=\"hljs-string\"\u003e`webpack detected change...`\u003c/span\u003e);\n        });\n        compiler.hooks.invalid.tap(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;WatchReportChangePlugin\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003efileName\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n            logger.log(\u003cspan class=\"hljs-string\"\u003e`webpack change detected to \u003cspan class=\"hljs-subst\"\u003e${fileName}\u003c/span\u003e`\u003c/span\u003e);\n        });\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e opts = {\n            \u003cspan class=\"hljs-attr\"\u003eaggregateTimeout\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003epoll\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eignored\u003c/span\u003e: [],\n        };\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e hasCompleted = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n        compiler.watch(opts, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eerr, stats\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (err) {\n                logger.error(\u003cspan class=\"hljs-string\"\u003e`web pack error: \u003cspan class=\"hljs-subst\"\u003e${err.message}\u003c/span\u003e \u003cspan class=\"hljs-subst\"\u003e${err.stack}\u003c/span\u003e`\u003c/span\u003e);\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!hasCompleted) {\n                    reject(err);\n                    hasCompleted = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n                }\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n            }\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!hasCompleted) {\n                resolve();  \n                hasCompleted = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n            }\n        });\n    });\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 class=\"text-2xl font-medium mb-2 mt-3\"\u003eWrite Some Frontend Code\u003c/h2\u003e\n\u003cp\u003eAfter setup the build tool, we can create some front-end code to test that our packaging tool is working properly. Under \u003ccode\u003e/src/app\u003c/code\u003e, let’s create these file:\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode\u003eapp\n├── start-client.ts\n├── client.tsx\n└── frontend\n    ├── index.tsx\n    └── style.css\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003estart-client.ts\u003c/code\u003e is the frontend entry file, \u003ccode\u003eclient.tsx\u003c/code\u003e is the start point of React. \u003ccode\u003e/frontend/index.tsx\u003c/code\u003e is a simple React component for demonstrate whether the css module is working or not.\u003c/p\u003e\n\u003cp\u003eCode in \u003ccode\u003estart-client.ts\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"language-Typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { FrontendClient } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;./client\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { LogLevel } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;../utils/logger\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { createLogger } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;./logger\u0026#x27;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ego\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e logger = createLogger({\n        \u003cspan class=\"hljs-attr\"\u003elogLevel\u003c/span\u003e: LogLevel.DEBUG,\n        \u003cspan class=\"hljs-attr\"\u003elogPrefixRegex\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e,\n    });\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e client = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e FrontendClient({\n        logger,\n    });\n\n    client.start();\n}\n\ngo().catch(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.error(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;frontend client start error\u0026#x27;\u003c/span\u003e);\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.error(e);\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eand this is the code in \u003ccode\u003eclient.tsx\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"language-Typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e * \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e React \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;react\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e * \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e ReactDOM \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;react-dom\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { Logger } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;../utils/logger\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { FrontendUI } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;./frontend\u0026#x27;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eFrontendClient\u003c/span\u003e \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e logger:Logger;\n    \u003cspan class=\"hljs-keyword\"\u003eprivate\u003c/span\u003e rootDiv:HTMLDivElement;\n\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003espec:{\n        logger:Logger,\n    }\u003c/span\u003e)\u003c/span\u003e {\n        \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.logger = spec.logger;\n        \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.rootDiv = \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.createElement(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;div\u0026#x27;\u003c/span\u003e);\n        \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.rootDiv.style.left = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;0\u0026#x27;\u003c/span\u003e;\n        \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.rootDiv.style.right = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;0\u0026#x27;\u003c/span\u003e;\n        \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.body.appendChild(\u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.rootDiv);\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003estart\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e {\n        \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.render();\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e {\n        ReactDOM.render(\n            \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eFrontendUI\u003c/span\u003e\n                \u003cspan class=\"hljs-attr\"\u003eclient\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{this}\u003c/span\u003e\n            \u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eFrontendUI\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e,\n            \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.rootDiv,\n        );\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe reason we use \u003ccode\u003estart-client.ts\u003c/code\u003e as entry file instead of ‘.tsx’ file is, before we render the page, we may need to do some preparations, such as initializing the websocket, register RPC protocol or connect to the backend system.\u003c/p\u003e\n\u003cp\u003eAfter we setup the frontend code, we can try to compile the code with our build tool, add this line to your \u003ccode\u003epackage.json\u003c/code\u003e’s scripts scope:\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode\u003e\u0026quot;watch\u0026quot;: \u0026quot;TS_NODE_PROJECT=node.tsconfig.json ts-node src/bin/watch.ts\u0026quot;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen, just type \u003ccode\u003enpm run watch\u003c/code\u003e, you should see some log about the compilation process are printed in the terminal. In few seconds, a ‘build’ folder will be created in the root directory, which contain the compiled files.\u003c/p\u003e\n\u003cp\u003eNow that we have configured webpack and ensured that the cssModule works,  let’s see how to make tailwind work as well. Currently, the webpack conifg’s module scope looks like this:\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"language-Javascript\"\u003e\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003erules\u003c/span\u003e: [\n        {\n            \u003cspan class=\"hljs-attr\"\u003etest\u003c/span\u003e: \u003cspan class=\"hljs-regexp\"\u003e/\\.tsx?$/\u003c/span\u003e,\n            use: [\n                {\n                    \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;ts-loader\u0026#x27;\u003c/span\u003e,\n                    \u003cspan class=\"hljs-attr\"\u003eoptions\u003c/span\u003e: {\n                        \u003cspan class=\"hljs-attr\"\u003econfigFile\u003c/span\u003e: path.join(ROOT, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;client.tsconfig.json\u0026#x27;\u003c/span\u003e),\n                    },\n                },\n            ],\n            \u003cspan class=\"hljs-attr\"\u003einclude\u003c/span\u003e: SRC,\n        },\n        {\n            \u003cspan class=\"hljs-attr\"\u003etest\u003c/span\u003e: \u003cspan class=\"hljs-regexp\"\u003e/\\.css$/\u003c/span\u003e,\n            include: SRC,\n            \u003cspan class=\"hljs-attr\"\u003euse\u003c/span\u003e: [\n                {\n                    \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: MiniCssExtractPlugin.loader,\n                },\n                {\n                    \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;css-loader\u0026#x27;\u003c/span\u003e,\n                    \u003cspan class=\"hljs-attr\"\u003eoptions\u003c/span\u003e: {\n                        \u003cspan class=\"hljs-attr\"\u003emodules\u003c/span\u003e: {\n                            \u003cspan class=\"hljs-attr\"\u003elocalIdentName\u003c/span\u003e: isDev\n                                ? \u003cspan class=\"hljs-string\"\u003e\u0026#x27;[path][name]__[local]--[hash:base64:5]\u0026#x27;\u003c/span\u003e\n                                : \u003cspan class=\"hljs-string\"\u003e\u0026#x27;[hash:base64]\u0026#x27;\u003c/span\u003e,\n                        },\n                        \u003cspan class=\"hljs-attr\"\u003eimportLoaders\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n                        \u003cspan class=\"hljs-attr\"\u003eurl\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n                    },\n                },\n                {\n                    \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;postcss-loader\u0026#x27;\u003c/span\u003e,\n                    \u003cspan class=\"hljs-attr\"\u003eoptions\u003c/span\u003e: {\n                        \u003cspan class=\"hljs-attr\"\u003eident\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;postcss\u0026#x27;\u003c/span\u003e,\n                        \u003cspan class=\"hljs-attr\"\u003eplugins\u003c/span\u003e: [\n                            cssValues,\n                            autoPrefixerPlugin,\n                        ],\n                    },\n                },\n            ],\n        },\n    ],\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNoticed, in the options of \u003ccode\u003ecss-loader\u003c/code\u003e, we have config the localIdentName, css Module have no problem with this, but it’s not true with Tailwind css. We can think of tailwind css as a global css framework, all we need to do is to concat its css code to our final code without any modification. From the Tailwind Installation instruction, here are the thing we need to do:\u003c/p\u003e\n\u003cp\u003e1 . install package, once again, I will give the specific version. Since we already have autoprefixer installed, we don’t need to install it agian.\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode\u003e\u0026quot;@tailwindcss/postcss7-compat\u0026quot;: \u0026quot;^2.0.2\u0026quot;,\n\u0026quot;tailwindcss\u0026quot;: \u0026quot;npm:@tailwindcss/postcss7-compat@^2.0.2\u0026quot;,\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e2 . create \u003ccode\u003etailwind.config.js\u003c/code\u003e and \u003ccode\u003epostcss.config.js\u003c/code\u003e, then fill them with these code:\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// tailwind.config.js\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n  \u003cspan class=\"hljs-attr\"\u003epurge\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\u0026#x27;./src/**/*.{js,jsx,ts,tsx}\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;./public/index.html\u0026#x27;\u003c/span\u003e],\n  \u003cspan class=\"hljs-attr\"\u003edarkMode\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// or \u0026#x27;media\u0026#x27; or \u0026#x27;class\u0026#x27;\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003etheme\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003eextend\u003c/span\u003e: {},\n  },\n  \u003cspan class=\"hljs-attr\"\u003evariants\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003eextend\u003c/span\u003e: {},\n  },\n  \u003cspan class=\"hljs-attr\"\u003eplugins\u003c/span\u003e: [],\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// postcss.config.js\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e.exports = {\n    \u003cspan class=\"hljs-attr\"\u003eplugins\u003c/span\u003e: [\n        \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;autoprefixer\u0026#x27;\u003c/span\u003e),\n        \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;tailwindcss\u0026#x27;\u003c/span\u003e),\n    ],\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNext, create \u003ccode\u003eglobal.css\u003c/code\u003e in \u003ccode\u003e/src/app\u003c/code\u003e folder and add these line:\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode\u003e@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen we need to change the webpack config a little bit, at this time, we need to test ‘css’ file twice, the first time we will skip \u003ccode\u003eglobal.css\u003c/code\u003e, the second time will only include \u003ccode\u003eglobal.css\u003c/code\u003e. So, we need to change config’s module scope to this:\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-built_in\"\u003emodule\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003erules\u003c/span\u003e: [\n        {\n            \u003cspan class=\"hljs-attr\"\u003etest\u003c/span\u003e: \u003cspan class=\"hljs-regexp\"\u003e/\\.tsx?$/\u003c/span\u003e,\n            use: [\n                {\n                    \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;ts-loader\u0026#x27;\u003c/span\u003e,\n                    \u003cspan class=\"hljs-attr\"\u003eoptions\u003c/span\u003e: {\n                        \u003cspan class=\"hljs-attr\"\u003econfigFile\u003c/span\u003e: websiteTsConfig,\n                    },\n                },\n            ],\n            \u003cspan class=\"hljs-attr\"\u003einclude\u003c/span\u003e: SRC,\n        },\n        {\n            \u003cspan class=\"hljs-attr\"\u003etest\u003c/span\u003e: \u003cspan class=\"hljs-regexp\"\u003e/\\.css$/\u003c/span\u003e,\n            include: SRC,\n            \u003cspan class=\"hljs-attr\"\u003euse\u003c/span\u003e: [\n                {\n                    \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: MiniCssExtractPlugin.loader,\n                },\n                {\n                    \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;css-loader\u0026#x27;\u003c/span\u003e,\n                    \u003cspan class=\"hljs-attr\"\u003eoptions\u003c/span\u003e: {\n                        \u003cspan class=\"hljs-attr\"\u003emodules\u003c/span\u003e: {\n                            \u003cspan class=\"hljs-attr\"\u003elocalIdentName\u003c/span\u003e: isDev\n                                ? \u003cspan class=\"hljs-string\"\u003e\u0026#x27;[path][name]__[local]--[hash:base64:5]\u0026#x27;\u003c/span\u003e\n                                : \u003cspan class=\"hljs-string\"\u003e\u0026#x27;[hash:base64]\u0026#x27;\u003c/span\u003e,\n                        },\n                        \u003cspan class=\"hljs-attr\"\u003eimportLoaders\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n                        \u003cspan class=\"hljs-attr\"\u003eurl\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n                    },\n                },\n                {\n                    \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;postcss-loader\u0026#x27;\u003c/span\u003e,\n                    \u003cspan class=\"hljs-attr\"\u003eoptions\u003c/span\u003e: {\n                        \u003cspan class=\"hljs-attr\"\u003eident\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;postcss\u0026#x27;\u003c/span\u003e,\n                        \u003cspan class=\"hljs-attr\"\u003eplugins\u003c/span\u003e: [\n                            cssValues,\n                            autoPrefixerPlugin,\n                        ],\n                    },\n                },\n            ],\n            \u003cspan class=\"hljs-attr\"\u003eexclude\u003c/span\u003e: \u003cspan class=\"hljs-regexp\"\u003e/(global.css)/\u003c/span\u003e,\n        },\n        {\n            \u003cspan class=\"hljs-attr\"\u003etest\u003c/span\u003e: \u003cspan class=\"hljs-regexp\"\u003e/\\.css$/\u003c/span\u003e,\n            include: \u003cspan class=\"hljs-regexp\"\u003e/(global.css)/\u003c/span\u003e,\n            use: [{\n                \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: MiniCssExtractPlugin.loader,\n                \u003cspan class=\"hljs-attr\"\u003eoptions\u003c/span\u003e: {\n                    \u003cspan class=\"hljs-attr\"\u003epublicPath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;../\u0026#x27;\u003c/span\u003e,\n                },\n            },\n            {\n                \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;css-loader\u0026#x27;\u003c/span\u003e,\n                \u003cspan class=\"hljs-attr\"\u003eoptions\u003c/span\u003e: {\n                    \u003cspan class=\"hljs-attr\"\u003emodules\u003c/span\u003e: {\n                        \u003cspan class=\"hljs-attr\"\u003elocalIdentName\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;[local]\u0026#x27;\u003c/span\u003e\n                    },\n                    \u003cspan class=\"hljs-attr\"\u003eimportLoaders\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n                    \u003cspan class=\"hljs-attr\"\u003eurl\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e,\n                },\n            },\n            {\n                \u003cspan class=\"hljs-attr\"\u003eloader\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;postcss-loader\u0026#x27;\u003c/span\u003e,\n                \u003cspan class=\"hljs-attr\"\u003eoptions\u003c/span\u003e: {\n                    \u003cspan class=\"hljs-attr\"\u003eident\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;postcss\u0026#x27;\u003c/span\u003e,\n                    \u003cspan class=\"hljs-attr\"\u003eplugins\u003c/span\u003e: [\n                        tailwindcss(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;./tailwind.config.js\u0026#x27;\u003c/span\u003e),\n                        cssValues,\n                        autoPrefixerPlugin,\n                    ],\n                },\n            }],\n        },\n    ],\n},\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow, the tailwind css will working.\u003c/p\u003e\n\u003ch2 class=\"text-2xl font-medium mb-2 mt-3\"\u003eServer Setup\u003c/h2\u003e\n\u003cp\u003eFinally, we come to the server.\u003c/p\u003e\n\u003cp\u003e1 . create these file under src folder:\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode\u003esrc\n├── app\n│   └── start-server.ts\n└── utils\n    └── start-app\n        ├── html-entry.ts\n        └── server.ts\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003estart-server.ts\u003c/code\u003e is the entry file of our nodejs server, \u003ccode\u003esrc/utils/server.ts\u003c/code\u003e contain some helper function and \u003ccode\u003esrc/utils/html-entry.ts\u003c/code\u003e is responsible for build the ‘index.html’ content.\u003c/p\u003e\n\u003cp\u003eFirst, install the package: \u003ccode\u003enpm install ip\u003c/code\u003e, then we add ‘startServer’ and ‘createDefaultHttpHandler’ function in the \u003ccode\u003esrc/utils/server.ts\u003c/code\u003e.\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e http \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;http\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e ip \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;ip\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e url \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;url\u0026#x27;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e RouteHandler = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ereq:http.IncomingMessage, res:http.ServerResponse\u003c/span\u003e) =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-built_in\"\u003evoid\u003c/span\u003e\u0026gt;;\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e RouteHandlers = {[path:\u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e]:RouteHandler};\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003estartServer\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003espec: {\n    port:\u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e;\n    httpHandler:RouteHandler;\n    start:(spec: {httpServer:http.Server}) =\u0026gt; \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-built_in\"\u003evoid\u003c/span\u003e\u0026gt;;\n    logger:Logger;\n}\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e logger = spec.logger;\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e httpServer = http.createServer(spec.httpHandler);\n\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e spec.start({httpServer});\n\n    httpServer.listen(spec.port);\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e address = ip.address();\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e serverURL = \u003cspan class=\"hljs-string\"\u003e`http://\u003cspan class=\"hljs-subst\"\u003e${address}\u003c/span\u003e:\u003cspan class=\"hljs-subst\"\u003e${spec.port}\u003c/span\u003e`\u003c/span\u003e;\n    logger.log(\u003cspan class=\"hljs-string\"\u003e`server address: \u003cspan class=\"hljs-subst\"\u003e${serverURL}\u003c/span\u003e`\u003c/span\u003e);\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ecreateDefaultHttpHandler\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003espec:{\n    routes:RouteHandlers,\n    logger:Logger,\n    defaultRoute?:RouteHandler;\n}\u003c/span\u003e) : \u003cspan class=\"hljs-title\"\u003ePromise\u003c/span\u003e\u0026lt;\u003cspan class=\"hljs-title\"\u003eRouteHandler\u003c/span\u003e\u0026gt; \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e contentRouter;\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e routes = spec.routes;\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e logger = spec.logger || \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e (req:http.IncomingMessage, \u003cspan class=\"hljs-attr\"\u003eres\u003c/span\u003e:http.ServerResponse) =\u0026gt; {\n        res.setHeader(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Access-Control-Allow-Origin\u0026#x27;\u003c/span\u003e, req.headers \u0026amp;\u0026amp; req.headers.origin || \u003cspan class=\"hljs-string\"\u003e\u0026#x27;*\u0026#x27;\u003c/span\u003e);\n        res.setHeader(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Access-Control-Allow-Methods\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;GET,PUT,POST,DELETE\u0026#x27;\u003c/span\u003e);\n        res.setHeader(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Access-Control-Allow-Headers\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Content-Type\u0026#x27;\u003c/span\u003e);\n        res.setHeader(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Access-Control-Allow-Credentials\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;true\u0026#x27;\u003c/span\u003e);\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!req.url) {\n            res.writeHead(\u003cspan class=\"hljs-number\"\u003e400\u003c/span\u003e);\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e res.end(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;url cannot be empty\u0026#x27;\u003c/span\u003e);\n        }\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { pathname } = url.parse(req.url);\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (routes[\u003cspan class=\"hljs-string\"\u003e\u0026#x27;/index.html\u0026#x27;\u003c/span\u003e] \u0026amp;\u0026amp; (!pathname || \u003cspan class=\"hljs-regexp\"\u003e/^\\/?(index\\.html?)?$/\u003c/span\u003e.test(pathname))) {\n            logger.debug(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;serving generated index\u0026#x27;\u003c/span\u003e);\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e routes[\u003cspan class=\"hljs-string\"\u003e\u0026#x27;/index.html\u0026#x27;\u003c/span\u003e](req, res);\n        }\n\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (pathname) {\n            \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e routeHandler = routes[pathname];\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!routeHandler) {\n                \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e reg = pathname.match(\u003cspan class=\"hljs-regexp\"\u003e/^\\/[a-zA-Z0-9._]+/\u003c/span\u003e);\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (reg) {\n                    routeHandler = routes[reg[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]];\n                }\n            }\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (routeHandler) {\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e routeHandler(req, res);\n            }\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (pathname === \u003cspan class=\"hljs-string\"\u003e\u0026#x27;/healthCheck\u0026#x27;\u003c/span\u003e) {\n                res.setHeader(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Content-Type\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;application/json\u0026#x27;\u003c/span\u003e);\n                res.end(\u003cspan class=\"hljs-string\"\u003e`{status: \u0026quot;good\u0026quot;}`\u003c/span\u003e);\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n            }\n\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!pathname.match(\u003cspan class=\"hljs-regexp\"\u003e/\\.(js|css|html)$/\u003c/span\u003e) \u0026amp;\u0026amp; spec.defaultRoute) {\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e spec.defaultRoute(req, res);\n            }\n        }\n        res.writeHead(\u003cspan class=\"hljs-number\"\u003e400\u003c/span\u003e);\n        res.end(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;resource not found\u0026#x27;\u003c/span\u003e);\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFrom the code above, you should already see that we are handling the routes directly through nodejs, rather than installing a toolkit such as express. The fact is, in most of the cases, we don’t need to install express at all. It is not complicated to write a routing logic directly with nodejs.\u003c/p\u003e\n\u003cp\u003eIn the \u003ccode\u003estart-server.ts\u003c/code\u003e, we add routes \u003ccode\u003e/bundle.js\u003c/code\u003e, \u003ccode\u003e/bundle.css\u003c/code\u003e and \u003ccode\u003e/index.html\u003c/code\u003e, we also need to create routes to handle static file request and bad request.\u003c/p\u003e\n\u003cdiv class='preCodeBlock'\u003e\u003c/div\u003e\n\u003cpre\u003e\u003ccode class=\"language-Typescript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e fs \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;fs\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e http \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;http\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e url \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;url\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e util \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;util\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { config } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;./config\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e * \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e PATHS \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;../bin/utils/paths\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { startServer, createDefaultHttpHandler, RouteHandlers } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;../utils/start-app/server\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { htmlEntry } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;../utils/start-app/html-entry\u0026#x27;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ego\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003egetHtml\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres:http.ServerResponse, htmlSpec?:\u003cspan class=\"hljs-built_in\"\u003eobject\u003c/span\u003e\u003c/span\u003e) \u003c/span\u003e{\n        res.writeHead(\u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, {\n            \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Content-Type\u0026#x27;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;text/html\u0026#x27;\u003c/span\u003e,\n            \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Cache-Control\u0026#x27;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;private, no-cache, no-store, must-revalidate\u0026#x27;\u003c/span\u003e,\n            \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Expire\u0026#x27;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;-1\u0026#x27;\u003c/span\u003e,\n            \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Pragma\u0026#x27;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;no-cache\u0026#x27;\u003c/span\u003e,\n        });\n        res.end(Buffer.from(htmlEntry({\n            \u003cspan class=\"hljs-attr\"\u003etitle\u003c/span\u003e: ...,\n            \u003cspan class=\"hljs-attr\"\u003edescription\u003c/span\u003e: ...,\n            \u003cspan class=\"hljs-attr\"\u003ecssBundle\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;/bundle.css\u0026#x27;\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003ejsBundle\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;/bundle.js\u0026#x27;\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003emanifest\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eviewPort\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003ebodyHtml\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e,\n            \u003cspan class=\"hljs-attr\"\u003eheadHtml\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;\u0026#x27;\u003c/span\u003e,\n        }), \u003cspan class=\"hljs-string\"\u003e\u0026#x27;utf8\u0026#x27;\u003c/span\u003e));\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e routes:RouteHandlers = {\n        \u003cspan class=\"hljs-string\"\u003e\u0026#x27;/bundle.js\u0026#x27;\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e (req:http.IncomingMessage, \u003cspan class=\"hljs-attr\"\u003eres\u003c/span\u003e:http.ServerResponse) =\u0026gt; {\n            res.writeHead(\u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, {\n                \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Content-Type\u0026#x27;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;text/javascript\u0026#x27;\u003c/span\u003e,\n                \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Cache-Control\u0026#x27;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;private, no-cache, no-store, must-revalidate\u0026#x27;\u003c/span\u003e,\n                \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Expire\u0026#x27;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;-1\u0026#x27;\u003c/span\u003e,\n                \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Pragma\u0026#x27;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;no-cache\u0026#x27;\u003c/span\u003e,\n            });\n            fs.createReadStream(PATHS.FRONTEND_JS).pipe(res);\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n        },\n        \u003cspan class=\"hljs-string\"\u003e\u0026#x27;/bundle.css\u0026#x27;\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e (req, res) =\u0026gt; {\n            res.writeHead(\u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, {\n                \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Content-Type\u0026#x27;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;text/css\u0026#x27;\u003c/span\u003e,\n                \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Cache-Control\u0026#x27;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;private, no-cache, no-store, must-revalidate\u0026#x27;\u003c/span\u003e,\n                \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Expire\u0026#x27;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;-1\u0026#x27;\u003c/span\u003e,\n                \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Pragma\u0026#x27;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;no-cache\u0026#x27;\u003c/span\u003e,\n            });\n            fs.createReadStream(PATHS.FRONTEND_CSS).pipe(res);\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n        },\n        \u003cspan class=\"hljs-string\"\u003e\u0026#x27;/index.html\u0026#x27;\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e (req, res) =\u0026gt; getHtml(res),\n    };\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e logger = createLogger({\n        \u003cspan class=\"hljs-attr\"\u003elogLevel\u003c/span\u003e: config.logLevel,\n        \u003cspan class=\"hljs-attr\"\u003elogPrefixRegex\u003c/span\u003e: config.logPrefixRegex,\n    });\n\n    \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e startServer({\n        \u003cspan class=\"hljs-attr\"\u003eport\u003c/span\u003e: config.port,\n        \u003cspan class=\"hljs-attr\"\u003eenv\u003c/span\u003e: config.env,\n        \u003cspan class=\"hljs-attr\"\u003edevelopment\u003c/span\u003e: config.env === \u003cspan class=\"hljs-string\"\u003e\u0026#x27;development\u0026#x27;\u003c/span\u003e,\n        logger,\n        \u003cspan class=\"hljs-attr\"\u003ehttpHandler\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e createDefaultHttpHandler({\n            \u003cspan class=\"hljs-attr\"\u003edevelopment\u003c/span\u003e: config.env === \u003cspan class=\"hljs-string\"\u003e\u0026#x27;development\u0026#x27;\u003c/span\u003e,\n            routes,\n            logger,\n            \u003cspan class=\"hljs-attr\"\u003edefaultRoute\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e (req:http.IncomingMessage, \u003cspan class=\"hljs-attr\"\u003eres\u003c/span\u003e:http.ServerResponse) =\u0026gt; {\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!req.url) {\n                    res.writeHead(\u003cspan class=\"hljs-number\"\u003e400\u003c/span\u003e);\n                    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e res.end(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;url cannot be empty\u0026#x27;\u003c/span\u003e);\n                }\n                \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { pathname } = url.parse(req.url);\n                \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e publicStaticFile = PATHS.PUBLIC + pathname;\n                \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e stats = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e util.promisify(fs.stat)(publicStaticFile).catch(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eerror\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n                    logger.error(error);\n                    res.writeHead(\u003cspan class=\"hljs-number\"\u003e400\u003c/span\u003e);\n                    res.end(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;resource not found\u0026#x27;\u003c/span\u003e);\n                    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n                });\n\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (stats \u0026amp;\u0026amp; stats.isFile()) {\n                    fs.createReadStream(publicStaticFile).pipe(res);\n                    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n                }\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n            },\n        }),\n        \u003cspan class=\"hljs-attr\"\u003estart\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e () =\u0026gt; {\n        },\n    });\n}\n\ngo().catch(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.error(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;start server error\u0026#x27;\u003c/span\u003e);\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.error(e);\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn order to run the server, add \u003ccode\u003e\u0026quot;start\u0026quot;: \u0026quot;TS_NODE_PROJECT=node.tsconfig.json ts-node src/app/start-server.ts\u0026quot;\u003c/code\u003e to your package.json, then type \u003ccode\u003enpm start\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eNow, your app is running!\u003c/p\u003e\n","title":"WebApp setup from scratch","pic":"/images/web-app-setup-1/1.png","keyword":"React, Webpack, Nodejs","description":"Setup a web application from scratch without using create-react-app and webpack-cli. With CSS configuration so that the Tailwind can coexist with css module.","date":"2019-02-23"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"web-app-setup-1"},"buildId":"nWe2piL5lTgwzj_2F2F8A","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-feb8a7604fa7fce626b2.js"></script><script src="/_next/static/chunks/main-b6d312587e2afb5b7e03.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.9d524150d48315f49e80.js" async=""></script><script src="/_next/static/chunks/7a55d4b5.210d3c80a2b0e2401248.js" async=""></script><script src="/_next/static/chunks/commons.0a849237534e67e84d9a.js" async=""></script><script src="/_next/static/chunks/pages/_app-5606e023d1fe164dc1fd.js" async=""></script><script src="/_next/static/chunks/df27990eef8845831ef4a3353c0adb327953b68f.6ebe35bf6c0aadc1eb95.js" async=""></script><script src="/_next/static/chunks/7989c093b81d86ddb0abfb342d5bc2e84730435d.a80097bea88316e5b19e.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-67fc6c234c356062955a.js" async=""></script><script src="/_next/static/nWe2piL5lTgwzj_2F2F8A/_buildManifest.js" async=""></script><script src="/_next/static/nWe2piL5lTgwzj_2F2F8A/_ssgManifest.js" async=""></script></body></html>